<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>悲伤的橘子树</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="不相信自己的人没有努力的价值。   -- 迈特凯">
<meta name="keywords" content="悲伤的橘子树">
<meta property="og:type" content="website">
<meta property="og:title" content="悲伤的橘子树">
<meta property="og:url" content="http://fankekeke.club/index.html">
<meta property="og:site_name" content="悲伤的橘子树">
<meta property="og:description" content="不相信自己的人没有努力的价值。   -- 迈特凯">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="悲伤的橘子树">
<meta name="twitter:description" content="不相信自己的人没有努力的价值。   -- 迈特凯">
  
    <link rel="alternate" href="/atom.xml" title="悲伤的橘子树" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">悲伤的橘子树</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://fankekeke.club"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Rabbit交换器" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/21/Rabbit交换器/" class="article-date">
  <time datetime="2019-01-21T06:32:31.000Z" itemprop="datePublished">2019-01-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/消息队列/">消息队列</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/21/Rabbit交换器/">Rabbit交换器</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="Direct交换器-发布器与订阅-完全匹配"><a href="#Direct交换器-发布器与订阅-完全匹配" class="headerlink" title="Direct交换器(发布器与订阅 完全匹配)"></a>Direct交换器(发布器与订阅 完全匹配)</h4><blockquote>
<p><strong>搭建环境</strong></p>
</blockquote>
<h5 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h5><p>rabbitmq-direct-consumer<br>rabbitmq-direct-provider</p>
<h5 id="修改全局配置文件"><a href="#修改全局配置文件" class="headerlink" title="修改全局配置文件"></a>修改全局配置文件</h5><blockquote>
<p><strong>修改 Consumer 的配置文件</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">spring.application.name=springcloud-mq</span><br><span class="line">spring.rabbitmq.host=192.168.70.131</span><br><span class="line">spring.rabbitmq.port=5672</span><br><span class="line">spring.rabbitmq.username=oldlu</span><br><span class="line">spring.rabbitmq.password=123456</span><br><span class="line">#设置交换器的名称</span><br><span class="line">mq.config.exchange=log.direct</span><br><span class="line">#info 队列名称</span><br><span class="line">mq.config.queue.info=log.info</span><br><span class="line">#info 路由键</span><br><span class="line">mq.config.queue.info.routing.key=log.info.routing.key</span><br><span class="line">#error 队列名称</span><br><span class="line">mq.config.queue.error=log.error</span><br><span class="line">#error 路由键</span><br><span class="line">mq.config.queue.error.routing.key=log.error.routing.key</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>修改 Provider 的配置文件</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">spring.application.name=springcloud-mq</span><br><span class="line">spring.rabbitmq.host=192.168.70.131</span><br><span class="line">spring.rabbitmq.port=5672</span><br><span class="line">spring.rabbitmq.username=oldlu</span><br><span class="line">spring.rabbitmq.password=123456</span><br><span class="line">#设置交换器的名称</span><br><span class="line">mq.config.exchange=log.direct</span><br><span class="line">#info 路由键</span><br><span class="line">mq.config.queue.info.routing.key=log.info.routing.key</span><br><span class="line">#error 路由键</span><br><span class="line">mq.config.queue.error.routing.key=log.error.routing.key</span><br><span class="line">#error 队列名称</span><br><span class="line">mq.config.queue.error=log.error</span><br></pre></td></tr></table></figure>
<h5 id="编写Consumer"><a href="#编写Consumer" class="headerlink" title="编写Consumer"></a>编写Consumer</h5><blockquote>
<p><strong>InfoReceiver</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.ExchangeTypes;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 消息接收者</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@RabbitListener</span> bindings:绑定队列</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@QueueBinding</span> value:绑定队列的名称</span></span><br><span class="line"><span class="comment"> * exchange:配置交换器</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Queue</span> value:配置队列名称</span></span><br><span class="line"><span class="comment"> * autoDelete:是否是一个可删除的临时队列</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Exchange</span> value:为交换器起个名称</span></span><br><span class="line"><span class="comment"> * type:指定具体的交换器类型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RabbitListener</span>(</span><br><span class="line">        bindings=<span class="meta">@QueueBinding</span>(</span><br><span class="line">                value=<span class="meta">@Queue</span>(value=<span class="string">"$&#123;mq.config.queue.info&#125;"</span>,autoDelete=<span class="string">"true"</span>),</span><br><span class="line">                        exchange=<span class="meta">@Exchange</span>(value=<span class="string">"$&#123;mq.config.exchange&#125;"</span>,type= ExchangeTypes.DIRECT),</span><br><span class="line">                        key=<span class="string">"$&#123;mq.config.queue.info.routing.key&#125;"</span></span><br><span class="line">                )</span><br><span class="line">        )</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InfoReceiver</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 接收消息的方法。采用消息队列监听机制</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> msg</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RabbitHandler</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Info........receiver: "</span>+msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>ErrorReceiver</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.ExchangeTypes;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 消息接收者</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@RabbitListener</span> bindings:绑定队列</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@QueueBinding</span> value:绑定队列的名称</span></span><br><span class="line"><span class="comment"> * exchange:配置交换器</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Queue</span> value:配置队列名称</span></span><br><span class="line"><span class="comment"> * autoDelete:是否是一个可删除的临时队列</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Exchange</span> value:为交换器起个名称</span></span><br><span class="line"><span class="comment"> * type:指定具体的交换器类型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RabbitListener</span>(</span><br><span class="line">        bindings=<span class="meta">@QueueBinding</span>(</span><br><span class="line">                value=<span class="meta">@Queue</span>(value=<span class="string">"$&#123;mq.config.queue.error&#125;"</span>,autoDelete=<span class="string">"true"</span>),</span><br><span class="line">                        exchange=<span class="meta">@Exchange</span>(value=<span class="string">"$&#123;mq.config.exchange&#125;"</span>,type= ExchangeTypes.DIRECT),</span><br><span class="line">                        key=<span class="string">"$&#123;mq.config.queue.error.routing.key&#125;"</span></span><br><span class="line">                )</span><br><span class="line">        )</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ErrorReceiver</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 接收消息的方法。采用消息队列监听机制</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> msg</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RabbitHandler</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Error..........receiver: "</span>+msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="编写Provider"><a href="#编写Provider" class="headerlink" title="编写Provider"></a>编写Provider</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.AmqpTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 消息发送者</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sender</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AmqpTemplate rabbitAmqpTemplate;</span><br><span class="line">    <span class="comment">//exchange 交换器名称</span></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;mq.config.exchange&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String exchange;</span><br><span class="line">    <span class="comment">//routingkey 路由键</span></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;mq.config.queue.error.routing.key&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String routingkey;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 发送消息的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">        <span class="comment">//向消息队列发送消息</span></span><br><span class="line">        <span class="comment">//参数一：交换器名称。</span></span><br><span class="line">        <span class="comment">//参数二：路由键</span></span><br><span class="line">        <span class="comment">//参数三：消息</span></span><br><span class="line">        <span class="keyword">this</span>.rabbitAmqpTemplate.convertAndSend(<span class="keyword">this</span>.exchange,<span class="keyword">this</span>.routingkey, msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><hr></p>
<h4 id="Topic交换器-主题，规则匹配"><a href="#Topic交换器-主题，规则匹配" class="headerlink" title="Topic交换器(主题，规则匹配)"></a>Topic交换器(主题，规则匹配)</h4><blockquote>
<p><strong>搭建环境</strong></p>
</blockquote>
<h5 id="创建项目-1"><a href="#创建项目-1" class="headerlink" title="创建项目"></a>创建项目</h5><p>rabbitmq-topic-consumer<br>rabbitmq-topic-provider</p>
<h5 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h5><blockquote>
<p><strong>Provider</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">spring.application.name=springcloud-mq</span><br><span class="line">spring.rabbitmq.host=192.168.70.131</span><br><span class="line">spring.rabbitmq.port=5672</span><br><span class="line">spring.rabbitmq.username=oldlu</span><br><span class="line">spring.rabbitmq.password=123456</span><br><span class="line">#设置交换器的名称</span><br><span class="line">mq.config.exchange=log.topic</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>Consumer</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">spring.application.name=springcloud-mq</span><br><span class="line">spring.rabbitmq.host=192.168.70.131</span><br><span class="line">spring.rabbitmq.port=5672</span><br><span class="line">spring.rabbitmq.username=oldlu</span><br><span class="line">spring.rabbitmq.password=123456</span><br><span class="line">#设置交换器的名称</span><br><span class="line">mq.config.exchange=log.topic</span><br><span class="line">#info 队列名称</span><br><span class="line">mq.config.queue.info=log.info</span><br><span class="line">#error 队列名称</span><br><span class="line">mq.config.queue.error=log.error</span><br><span class="line">#log 队列名称</span><br><span class="line">mq.config.queue.logs=log.all</span><br></pre></td></tr></table></figure>
<h5 id="编写Provider-1"><a href="#编写Provider-1" class="headerlink" title="编写Provider"></a>编写Provider</h5><blockquote>
<p><strong>UserSender</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 消息发送者</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserSender</span> </span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> AmqpTemplate rabbitAmqpTemplate;</span><br><span class="line"><span class="comment">//exchange 交换器名称</span></span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;mq.config.exchange&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String exchange;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 发送消息的方法</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line"><span class="comment">//向消息队列发送消息</span></span><br><span class="line"><span class="comment">//参数一：交换器名称。</span></span><br><span class="line"><span class="comment">//参数二：路由键</span></span><br><span class="line"><span class="comment">//参数三：消息</span></span><br><span class="line"><span class="keyword">this</span>.rabbitAmqpTemplate.convertAndSend(<span class="keyword">this</span>.exchange,<span class="string">"user.</span></span><br><span class="line"><span class="string">log.debug"</span>, <span class="string">"user.log.debug....."</span>+msg);</span><br><span class="line"><span class="keyword">this</span>.rabbitAmqpTemplate.convertAndSend(<span class="keyword">this</span>.exchange,<span class="string">"user.</span></span><br><span class="line"><span class="string">log.info"</span>, <span class="string">"user.log.info....."</span>+msg);</span><br><span class="line"><span class="keyword">this</span>.rabbitAmqpTemplate.convertAndSend(<span class="keyword">this</span>.exchange,<span class="string">"user.</span></span><br><span class="line"><span class="string">log.warn"</span>,<span class="string">"user.log.warn....."</span>+msg);</span><br><span class="line"><span class="keyword">this</span>.rabbitAmqpTemplate.convertAndSend(<span class="keyword">this</span>.exchange,<span class="string">"user.</span></span><br><span class="line"><span class="string">log.error"</span>, <span class="string">"user.log.error....."</span>+msg);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>ProductSender</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 消息发送者</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductSender</span> </span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> AmqpTemplate rabbitAmqpTemplate;</span><br><span class="line"><span class="comment">//exchange 交换器名称</span></span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;mq.config.exchange&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String exchange;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 发送消息的方法</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line"><span class="comment">//向消息队列发送消息</span></span><br><span class="line"><span class="comment">//参数一：交换器名称。</span></span><br><span class="line"><span class="comment">//参数二：路由键</span></span><br><span class="line"><span class="comment">//参数三：消息</span></span><br><span class="line"><span class="keyword">this</span>.rabbitAmqpTemplate.convertAndSend(<span class="keyword">this</span>.exchange,<span class="string">"produ</span></span><br><span class="line"><span class="string">ct.log.debug"</span>, <span class="string">"product.log.debug....."</span>+msg);</span><br><span class="line"><span class="keyword">this</span>.rabbitAmqpTemplate.convertAndSend(<span class="keyword">this</span>.exchange,<span class="string">"produ</span></span><br><span class="line"><span class="string">ct.log.info"</span>, <span class="string">"product.log.info....."</span>+msg);</span><br><span class="line"><span class="keyword">this</span>.rabbitAmqpTemplate.convertAndSend(<span class="keyword">this</span>.exchange,<span class="string">"produ</span></span><br><span class="line"><span class="string">ct.log.warn"</span>,<span class="string">"product.log.warn....."</span>+msg);</span><br><span class="line"><span class="keyword">this</span>.rabbitAmqpTemplate.convertAndSend(<span class="keyword">this</span>.exchange,<span class="string">"produ</span></span><br><span class="line"><span class="string">ct.log.error"</span>, <span class="string">"product.log.error....."</span>+msg);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>OrderSender</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 消息发送者</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderSender</span> </span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> AmqpTemplate rabbitAmqpTemplate;</span><br><span class="line"><span class="comment">//exchange 交换器名称</span></span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;mq.config.exchange&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String exchange;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 发送消息的方法</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line"><span class="comment">//向消息队列发送消息</span></span><br><span class="line"><span class="comment">//参数一：交换器名称。</span></span><br><span class="line"><span class="comment">//参数二：路由键</span></span><br><span class="line"><span class="comment">//参数三：消息</span></span><br><span class="line"><span class="keyword">this</span>.rabbitAmqpTemplate.convertAndSend(<span class="keyword">this</span>.exchange,<span class="string">"order</span></span><br><span class="line"><span class="string">.log.debug"</span>, <span class="string">"order.log.debug....."</span>+msg);</span><br><span class="line"><span class="keyword">this</span>.rabbitAmqpTemplate.convertAndSend(<span class="keyword">this</span>.exchange,<span class="string">"order</span></span><br><span class="line"><span class="string">.log.info"</span>, <span class="string">"order.log.info....."</span>+msg);</span><br><span class="line"><span class="keyword">this</span>.rabbitAmqpTemplate.convertAndSend(<span class="keyword">this</span>.exchange,<span class="string">"order</span></span><br><span class="line"><span class="string">.log.warn"</span>,<span class="string">"order.log.warn....."</span>+msg);</span><br><span class="line"><span class="keyword">this</span>.rabbitAmqpTemplate.convertAndSend(<span class="keyword">this</span>.exchange,<span class="string">"order</span></span><br><span class="line"><span class="string">.log.error"</span>, <span class="string">"order.log.error....."</span>+msg);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="编写Consumer-1"><a href="#编写Consumer-1" class="headerlink" title="编写Consumer"></a>编写Consumer</h5><blockquote>
<p><strong>InfoReceiver</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 消息接收者</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment">* <span class="doctag">@RabbitListener</span> bindings:绑定队列</span></span><br><span class="line"><span class="comment">* <span class="doctag">@QueueBinding</span> value:绑定队列的名称</span></span><br><span class="line"><span class="comment">* exchange:配置交换器</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Queue</span> value:配置队列名称</span></span><br><span class="line"><span class="comment">* autoDelete:是否是一个可删除的临时队列</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Exchange</span> value:为交换器起个名称</span></span><br><span class="line"><span class="comment">* type:指定具体的交换器类型</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RabbitListener</span>(</span><br><span class="line">bindings=<span class="meta">@QueueBinding</span>(</span><br><span class="line">value=<span class="meta">@Queue</span>(value=<span class="string">"$&#123;mq.config.queue.info&#125;"</span>,autoDelete=<span class="string">"tr</span></span><br><span class="line"><span class="string">ue"</span>),</span><br><span class="line">exchange=<span class="meta">@Exchange</span>(value=<span class="string">"$&#123;mq.config.exchange&#125;"</span>,type=Excha</span><br><span class="line">ngeTypes.TOPIC),</span><br><span class="line">key=<span class="string">"*.log.info"</span></span><br><span class="line">)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InfoReceiver</span> </span>&#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 接收消息的方法。采用消息队列监听机制</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> msg</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@RabbitHandler</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">System.out.println(<span class="string">"......Info........receiver:</span></span><br><span class="line"><span class="string">"</span>+msg);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>ErrorReceiver</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 消息接收者</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment">* <span class="doctag">@RabbitListener</span> bindings:绑定队列</span></span><br><span class="line"><span class="comment">* <span class="doctag">@QueueBinding</span> value:绑定队列的名称</span></span><br><span class="line"><span class="comment">* exchange:配置交换器</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Queue</span> value:配置队列名称</span></span><br><span class="line"><span class="comment">* autoDelete:是否是一个可删除的临时队列</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Exchange</span> value:为交换器起个名称</span></span><br><span class="line"><span class="comment">* type:指定具体的交换器类型</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RabbitListener</span>(</span><br><span class="line">bindings=<span class="meta">@QueueBinding</span>(</span><br><span class="line">value=<span class="meta">@Queue</span>(value=<span class="string">"$&#123;mq.config.queue.error&#125;"</span>,autoDelete=<span class="string">"t</span></span><br><span class="line"><span class="string">rue"</span>),</span><br><span class="line">exchange=<span class="meta">@Exchange</span>(value=<span class="string">"$&#123;mq.config.exchange&#125;"</span>,type=Excha</span><br><span class="line">ngeTypes.TOPIC),</span><br><span class="line">key=<span class="string">"*.log.error"</span></span><br><span class="line">)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ErrorReceiver</span> </span>&#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 接收消息的方法。采用消息队列监听机制</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> msg</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@RabbitHandler</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">System.out.println(<span class="string">"......Error........receiver:</span></span><br><span class="line"><span class="string">"</span>+msg);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>LogsReceiver</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 消息接收者</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment">* <span class="doctag">@RabbitListener</span> bindings:绑定队列</span></span><br><span class="line"><span class="comment">* <span class="doctag">@QueueBinding</span> value:绑定队列的名称</span></span><br><span class="line"><span class="comment">* exchange:配置交换器</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Queue</span> value:配置队列名称</span></span><br><span class="line"><span class="comment">* autoDelete:是否是一个可删除的临时队列</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Exchange</span> value:为交换器起个名称</span></span><br><span class="line"><span class="comment">* type:指定具体的交换器类型</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RabbitListener</span>(</span><br><span class="line">bindings=<span class="meta">@QueueBinding</span>(</span><br><span class="line">value=<span class="meta">@Queue</span>(value=<span class="string">"$&#123;mq.config.queue.logs&#125;"</span>,autoDelete=<span class="string">"tr</span></span><br><span class="line"><span class="string">ue"</span>),</span><br><span class="line">exchange=<span class="meta">@Exchange</span>(value=<span class="string">"$&#123;mq.config.exchange&#125;"</span>,type=Excha</span><br><span class="line">ngeTypes.TOPIC),</span><br><span class="line">key=<span class="string">"*.log.*"</span></span><br><span class="line">)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogsReceiver</span> </span>&#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 接收消息的方法。采用消息队列监听机制</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> msg</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@RabbitHandler</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">System.out.println(<span class="string">"......All........receiver:</span></span><br><span class="line"><span class="string">"</span>+msg);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>测试代码</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UserSender usersender;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> ProductSender productsender;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> OrderSender ordersender;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 测试消息队列</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">this</span>.usersender.send(<span class="string">"UserSender....."</span>);</span><br><span class="line"><span class="keyword">this</span>.productsender.send(<span class="string">"ProductSender...."</span>);</span><br><span class="line"><span class="keyword">this</span>.ordersender.send(<span class="string">"OrderSender......"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><hr></p>
<h4 id="Fanout交换器-广播"><a href="#Fanout交换器-广播" class="headerlink" title="Fanout交换器(广播)"></a>Fanout交换器(广播)</h4><blockquote>
<p><strong>搭建环境</strong></p>
</blockquote>
<h5 id="创建项目-2"><a href="#创建项目-2" class="headerlink" title="创建项目"></a>创建项目</h5><p>rabbitmq-fanout-consumer<br>rabbitmq-fanout-provider</p>
<h5 id="修改配置文件-1"><a href="#修改配置文件-1" class="headerlink" title="修改配置文件"></a>修改配置文件</h5><blockquote>
<p><strong>consumer</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">spring.application.name=springcloud-mq</span><br><span class="line">spring.rabbitmq.host=192.168.70.131</span><br><span class="line">spring.rabbitmq.port=5672</span><br><span class="line">spring.rabbitmq.username=oldlu</span><br><span class="line">spring.rabbitmq.password=123456</span><br><span class="line">#设置交换器的名称</span><br><span class="line">mq.config.exchange=order.fanout</span><br><span class="line">#短信服务队列名称</span><br><span class="line">mq.config.queue.sms=order.sms</span><br><span class="line">#push 服务队列名称</span><br><span class="line">mq.config.queue.push=order.push</span><br></pre></td></tr></table></figure>
<blockquote>
<p>provider</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">spring.application.name=springcloud-mq</span><br><span class="line">spring.rabbitmq.host=192.168.70.131</span><br><span class="line">spring.rabbitmq.port=5672</span><br><span class="line">spring.rabbitmq.username=oldlu</span><br><span class="line">spring.rabbitmq.password=123456</span><br><span class="line">#设置交换器的名称</span><br><span class="line">mq.config.exchange=order.fanout</span><br></pre></td></tr></table></figure>
<h5 id="编写Consumer-2"><a href="#编写Consumer-2" class="headerlink" title="编写Consumer"></a>编写Consumer</h5><blockquote>
<p>SmsReceiver</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 消息接收者</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment">* <span class="doctag">@RabbitListener</span> bindings:绑定队列</span></span><br><span class="line"><span class="comment">* <span class="doctag">@QueueBinding</span> value:绑定队列的名称</span></span><br><span class="line"><span class="comment">* exchange:配置交换器</span></span><br><span class="line"><span class="comment">* key:路由键</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Queue</span> value:配置队列名称</span></span><br><span class="line"><span class="comment">* autoDelete:是否是一个可删除的临时队列</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Exchange</span> value:为交换器起个名称</span></span><br><span class="line"><span class="comment">* type:指定具体的交换器类型</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RabbitListener</span>(</span><br><span class="line">bindings=<span class="meta">@QueueBinding</span>(</span><br><span class="line">value=<span class="meta">@Queue</span>(value=<span class="string">"$&#123;mq.config.queue.sms&#125;"</span>,autoDelete=<span class="string">"tru</span></span><br><span class="line"><span class="string">e"</span>),</span><br><span class="line">exchange=<span class="meta">@Exchange</span>(value=<span class="string">"$&#123;mq.config.exchange&#125;"</span>,type=Excha</span><br><span class="line">ngeTypes.FANOUT)</span><br><span class="line">)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SmsReceiver</span> </span>&#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 接收消息的方法。采用消息队列监听机制</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> msg</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@RabbitHandler</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">System.out.println(<span class="string">"Sms........receiver: "</span>+msg);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>PushReceiver</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 消息接收者</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment">* <span class="doctag">@RabbitListener</span> bindings:绑定队列</span></span><br><span class="line"><span class="comment">* <span class="doctag">@QueueBinding</span> value:绑定队列的名称</span></span><br><span class="line"><span class="comment">* exchange:配置交换器</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Queue</span> value:配置队列名称</span></span><br><span class="line"><span class="comment">* autoDelete:是否是一个可删除的临时队列</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Exchange</span> value:为交换器起个名称</span></span><br><span class="line"><span class="comment">* type:指定具体的交换器类型</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RabbitListener</span>(</span><br><span class="line">bindings=<span class="meta">@QueueBinding</span>(</span><br><span class="line">value=<span class="meta">@Queue</span>(value=<span class="string">"$&#123;mq.config.queue.push&#125;"</span>,autoDelete=<span class="string">"tr</span></span><br><span class="line"><span class="string">ue"</span>),</span><br><span class="line">exchange=<span class="meta">@Exchange</span>(value=<span class="string">"$&#123;mq.config.exchange&#125;"</span>,type=Excha</span><br><span class="line">ngeTypes.FANOUT)</span><br><span class="line">)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PushReceiver</span> </span>&#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 接收消息的方法。采用消息队列监听机制</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> msg</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@RabbitHandler</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">System.out.println(<span class="string">"Push..........receiver: "</span>+msg);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="编写Provider-2"><a href="#编写Provider-2" class="headerlink" title="编写Provider"></a>编写Provider</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 消息发送者</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sender</span> </span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> AmqpTemplate rabbitAmqpTemplate;</span><br><span class="line"><span class="comment">//exchange 交换器名称</span></span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;mq.config.exchange&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String exchange;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 发送消息的方法</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line"><span class="comment">//向消息队列发送消息</span></span><br><span class="line"><span class="comment">//参数一：交换器名称。</span></span><br><span class="line"><span class="comment">//参数二：路由键</span></span><br><span class="line"><span class="comment">//参数三：消息</span></span><br><span class="line"><span class="keyword">this</span>.rabbitAmqpTemplate.convertAndSend(<span class="keyword">this</span>.exchange,<span class="string">""</span>,</span><br><span class="line">msg);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="RabbitMQ消息持久化"><a href="#RabbitMQ消息持久化" class="headerlink" title="RabbitMQ消息持久化"></a>RabbitMQ消息持久化</h4><p><strong>autoDelete</strong> 属性<br>@Queue: 当所有消费客户端连接断开后，是否自动删除<br>队列 true：删除 false：不删除<br>@Exchange：当所有绑定队列都不在使用时，是否自动<br>删除交换器 true：删除 false：不删除</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fankekeke.club/2019/01/21/Rabbit交换器/" data-id="cjrabl6o3001ivkdqrfyew6v3" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-监控SpringBoot健康状况" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/16/监控SpringBoot健康状况/" class="article-date">
  <time datetime="2019-01-16T02:44:05.000Z" itemprop="datePublished">2019-01-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/SpringBoot/">SpringBoot</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/16/监控SpringBoot健康状况/">监控SpringBoot健康状况</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="使用Actuator检查与监控"><a href="#使用Actuator检查与监控" class="headerlink" title="使用Actuator检查与监控"></a>使用Actuator检查与监控</h3><h4 id="在pom文件中添加Actuator的坐标"><a href="#在pom文件中添加Actuator的坐标" class="headerlink" title="在pom文件中添加Actuator的坐标"></a>在pom文件中添加Actuator的坐标</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<h4 id="在全局配置文件中关闭安全限制"><a href="#在全局配置文件中关闭安全限制" class="headerlink" title="在全局配置文件中关闭安全限制"></a>在全局配置文件中关闭安全限制</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">management.security.enabled=<span class="keyword">false</span></span><br></pre></td></tr></table></figure>
<hr>

<table>
<thead>
<tr>
<th>ID</th>
<th>描述</th>
<th>是否需要鉴权</th>
</tr>
</thead>
<tbody>
<tr>
<td>actuator</td>
<td>为其他端点提供“发现页面”。要求 Spring HATEOAS 在 classpath 路径上。</td>
<td>需要</td>
</tr>
<tr>
<td>auditevents</td>
<td>陈列当前应用程序的审计事件信息。</td>
<td>需要</td>
</tr>
<tr>
<td>autoconfig</td>
<td>展示自动配置信息并且显示所有自动配置候选人以及他们“被不被”应用的原因。</td>
<td>需要</td>
</tr>
<tr>
<td>beans</td>
<td>显示应用程序中所有 Spring bean 的完整列表。</td>
<td>需要</td>
</tr>
<tr>
<td>configprops</td>
<td>显示所有配置信息。</td>
<td>需要</td>
</tr>
<tr>
<td>dump</td>
<td>dump 所有线程。</td>
<td>需要</td>
</tr>
<tr>
<td>env</td>
<td>陈列所有的环境变量。</td>
<td>需要</td>
</tr>
<tr>
<td>flyway</td>
<td>Shows any Flyway database migrations that have been applied.</td>
<td>需要</td>
</tr>
<tr>
<td>health</td>
<td>显示应用程序运行状况信息</td>
<td>不需要</td>
</tr>
<tr>
<td>info</td>
<td>显示应用信息。</td>
<td>不需要</td>
</tr>
<tr>
<td>loggers</td>
<td>显示和修改应用程序中的 loggers 配置。</td>
<td>需要</td>
</tr>
<tr>
<td>liquibase</td>
<td>显示已经应用的任何 Liquibase 数据库迁移。</td>
<td>需要</td>
</tr>
<tr>
<td>metrics</td>
<td>显示当前应用程序的“指标”信息。</td>
<td>需要</td>
</tr>
<tr>
<td>mappings</td>
<td>显示所有@RequestMapping 的 url 整理列表。</td>
<td>需要</td>
</tr>
<tr>
<td>shutdown</td>
<td>关闭应用（默认情况下不启用）。</td>
<td>需要</td>
</tr>
<tr>
<td>trace</td>
<td>显示跟踪信息（默认最后 100 个 HTTP 请求）。</td>
<td>需要</td>
</tr>
</tbody>
</table>
<h3 id="使用可视化的监控报表-Spring-Boot-Admin"><a href="#使用可视化的监控报表-Spring-Boot-Admin" class="headerlink" title="使用可视化的监控报表-Spring Boot Admin"></a>使用可视化的监控报表-Spring Boot Admin</h3><p>SBA则是基于Actuator更加进化了一步，其是一个针对Actuator接口进行UI美化封装的监控工具。</p>
<h4 id="创建一个Spring-Boot-Admin-Server工程作为服务端"><a href="#创建一个Spring-Boot-Admin-Server工程作为服务端" class="headerlink" title="创建一个Spring Boot Admin Server工程作为服务端"></a>创建一个Spring Boot Admin Server工程作为服务端</h4><h4 id="服务端pom文件中添加添加坐标"><a href="#服务端pom文件中添加添加坐标" class="headerlink" title="服务端pom文件中添加添加坐标"></a>服务端pom文件中添加添加坐标</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>de.codecentric<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-admin-starter-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="服务端启动类添加注解"><a href="#服务端启动类添加注解" class="headerlink" title="服务端启动类添加注解"></a>服务端启动类添加注解</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableAdminServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringbootServerApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SpringbootServerApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="客户端pom文件中添加添加坐标"><a href="#客户端pom文件中添加添加坐标" class="headerlink" title="客户端pom文件中添加添加坐标"></a>客户端pom文件中添加添加坐标</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>de.codecentric<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-admin-starter-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="修改客户端的-application-properteis-配置文件"><a href="#修改客户端的-application-properteis-配置文件" class="headerlink" title="修改客户端的 application.properteis 配置文件"></a>修改客户端的 application.properteis 配置文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">management.security.enabled=false</span><br><span class="line">#http://localhost:9090 表示是 Spring Boot Admin 服务单的 IP 地</span><br><span class="line">址以及端口号</span><br><span class="line">spring.boot.admin.url: http://localhost:9090</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://fankekeke.club/2019/01/16/监控SpringBoot健康状况/" data-id="cjrabl6rp0042vkdqjgmk8z7i" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Java获取当前计算机信息" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/14/Java获取当前计算机信息/" class="article-date">
  <time datetime="2019-01-14T09:15:48.000Z" itemprop="datePublished">2019-01-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/14/Java获取当前计算机信息/">Java获取当前计算机信息</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.fanke.sms.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.NetworkInterface;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">getComputer</span> </span>&#123;</span><br><span class="line">    <span class="comment">//通过截取cmd流方式得到计算机的配置信息(不好)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">getIpAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Process p = <span class="keyword">null</span>;</span><br><span class="line">        List&lt;String&gt; address = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            p = <span class="keyword">new</span> ProcessBuilder(<span class="string">"ipconfig"</span>, <span class="string">"/all"</span>).start();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> address;</span><br><span class="line">        &#125;</span><br><span class="line">        StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        <span class="comment">//读取进程输出值</span></span><br><span class="line">        InputStream inputStream = p.getInputStream();</span><br><span class="line">        BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(inputStream));</span><br><span class="line">        String s = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> ((s = br.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                sb.append(s + <span class="string">"\n"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                inputStream.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(sb);</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getIpconfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Map&lt;String, String&gt; map = System.getenv();</span><br><span class="line">        System.out.println(map.get(<span class="string">"USERNAME"</span>));<span class="comment">//获取用户名</span></span><br><span class="line">        System.out.println(map.get(<span class="string">"COMPUTERNAME"</span>));<span class="comment">//获取计算机名</span></span><br><span class="line">        System.out.println(map.get(<span class="string">"USERDOMAIN"</span>));<span class="comment">//获取计算机域名</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//得到计算机的ip地址和mac地址</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            InetAddress address = InetAddress.getLocalHost();</span><br><span class="line">            NetworkInterface ni = NetworkInterface.getByInetAddress(address);</span><br><span class="line">            <span class="comment">//ni.getInetAddresses().nextElement().getAddress();</span></span><br><span class="line">            <span class="keyword">byte</span>[] mac = ni.getHardwareAddress();</span><br><span class="line">            String sIP = address.getHostAddress();</span><br><span class="line">            String sMAC = <span class="string">""</span>;</span><br><span class="line">            Formatter formatter = <span class="keyword">new</span> Formatter();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mac.length; i++) &#123;</span><br><span class="line">                sMAC = formatter.format(Locale.getDefault(), <span class="string">"%02X%s"</span>, mac[i],</span><br><span class="line">                        (i &lt; mac.length - <span class="number">1</span>) ? <span class="string">"-"</span> : <span class="string">""</span>).toString();</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"IP："</span> + sIP);</span><br><span class="line">            System.out.println(<span class="string">"MAC："</span> + sMAC);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//得到计算机的ip,名称,操作系统名称,操作系统版本</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Config</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            InetAddress addr = InetAddress.getLocalHost();</span><br><span class="line">            String ip=addr.getHostAddress().toString(); <span class="comment">//获取本机ip</span></span><br><span class="line">            String hostName=addr.getHostName().toString(); <span class="comment">//获取本机计算机名称</span></span><br><span class="line">            System.out.println(<span class="string">"本机IP："</span>+ip+<span class="string">"\n本机名称:"</span>+hostName);</span><br><span class="line">            Properties props=System.getProperties();</span><br><span class="line">            System.out.println(<span class="string">"操作系统的名称："</span>+props.getProperty(<span class="string">"os.name"</span>));</span><br><span class="line">            System.out.println(<span class="string">"操作系统的版本："</span>+props.getProperty(<span class="string">"os.version"</span>));</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//java环境</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">all</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Properties props=System.getProperties();</span><br><span class="line">        System.out.println(<span class="string">"Java的运行环境版本："</span>+props.getProperty(<span class="string">"java.version"</span>));</span><br><span class="line">        System.out.println(<span class="string">"Java的运行环境供应商："</span>+props.getProperty(<span class="string">"java.vendor"</span>));</span><br><span class="line">        System.out.println(<span class="string">"Java供应商的URL："</span>+props.getProperty(<span class="string">"java.vendor.url"</span>));</span><br><span class="line">        System.out.println(<span class="string">"Java的安装路径："</span>+props.getProperty(<span class="string">"java.home"</span>));</span><br><span class="line">        System.out.println(<span class="string">"Java的虚拟机规范版本："</span>+props.getProperty(<span class="string">"java.vm.specification.version"</span>));</span><br><span class="line">        System.out.println(<span class="string">"Java的虚拟机规范供应商："</span>+props.getProperty(<span class="string">"java.vm.specification.vendor"</span>));</span><br><span class="line">        System.out.println(<span class="string">"Java的虚拟机规范名称："</span>+props.getProperty(<span class="string">"java.vm.specification.name"</span>));</span><br><span class="line">        System.out.println(<span class="string">"Java的虚拟机实现版本："</span>+props.getProperty(<span class="string">"java.vm.version"</span>));</span><br><span class="line">        System.out.println(<span class="string">"Java的虚拟机实现供应商："</span>+props.getProperty(<span class="string">"java.vm.vendor"</span>));</span><br><span class="line">        System.out.println(<span class="string">"Java的虚拟机实现名称："</span>+props.getProperty(<span class="string">"java.vm.name"</span>));</span><br><span class="line">        System.out.println(<span class="string">"Java运行时环境规范版本："</span>+props.getProperty(<span class="string">"java.specification.version"</span>));</span><br><span class="line">        System.out.println(<span class="string">"Java运行时环境规范供应商："</span>+props.getProperty(<span class="string">"java.specification.vender"</span>));</span><br><span class="line">        System.out.println(<span class="string">"Java运行时环境规范名称："</span>+props.getProperty(<span class="string">"java.specification.name"</span>));</span><br><span class="line">        System.out.println(<span class="string">"Java的类格式版本号："</span>+props.getProperty(<span class="string">"java.class.version"</span>));</span><br><span class="line">        System.out.println(<span class="string">"Java的类路径："</span>+props.getProperty(<span class="string">"java.class.path"</span>));</span><br><span class="line">        System.out.println(<span class="string">"加载库时搜索的路径列表："</span>+props.getProperty(<span class="string">"java.library.path"</span>));</span><br><span class="line">        System.out.println(<span class="string">"默认的临时文件路径："</span>+props.getProperty(<span class="string">"java.io.tmpdir"</span>));</span><br><span class="line">        System.out.println(<span class="string">"一个或多个扩展目录的路径："</span>+props.getProperty(<span class="string">"java.ext.dirs"</span>));</span><br><span class="line">        System.out.println(<span class="string">"操作系统的名称："</span>+props.getProperty(<span class="string">"os.name"</span>));</span><br><span class="line">        System.out.println(<span class="string">"操作系统的构架："</span>+props.getProperty(<span class="string">"os.arch"</span>));</span><br><span class="line">        System.out.println(<span class="string">"操作系统的版本："</span>+props.getProperty(<span class="string">"os.version"</span>));</span><br><span class="line">        System.out.println(<span class="string">"文件分隔符："</span>+props.getProperty(<span class="string">"file.separator"</span>));<span class="comment">//在 unix 系统中是＂／＂ System.out.println("路径分隔符："+props.getProperty("path.separator"));//在 unix 系统中是＂:＂ System.out.println("行分隔符："+props.getProperty("line.separator"));//在 unix 系统中是＂/n＂ System.out.println("用户的账户名称："+props.getProperty("user.name"));</span></span><br><span class="line">        System.out.println(<span class="string">"用户的主目录："</span>+props.getProperty(<span class="string">"user.home"</span>));</span><br><span class="line">        System.out.println(<span class="string">"用户的当前工作目录："</span>+props.getProperty(<span class="string">"user.dir"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://fankekeke.club/2019/01/14/Java获取当前计算机信息/" data-id="cjrabl6nm000yvkdq9bpj9uue" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/工具/">工具</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-三网短信验证码API" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/14/三网短信验证码API/" class="article-date">
  <time datetime="2019-01-14T08:10:53.000Z" itemprop="datePublished">2019-01-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/14/三网短信验证码API/">三网短信验证码API</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://market.aliyun.com/products/56928004/cmapi022659.html?spm=5176.2020520132.101.7.4cfe7218y2RwKC#sku=yuncode16659000011" target="_blank" rel="noopener">购买</a></p>
<h4 id="HttpUtil"><a href="#HttpUtil" class="headerlink" title="HttpUtil"></a>HttpUtil</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.fanke.sms.util;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyManagementException;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"><span class="keyword">import</span> java.security.cert.X509Certificate;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.SSLContext;</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.TrustManager;</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.X509TrustManager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.NameValuePair;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.HttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.entity.UrlEncodedFormEntity;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpDelete;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpGet;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpPost;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpPut;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.conn.ClientConnectionManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.conn.scheme.Scheme;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.conn.scheme.SchemeRegistry;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.conn.ssl.SSLSocketFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.entity.ByteArrayEntity;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.entity.StringEntity;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.DefaultHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.message.BasicNameValuePair;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * get</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> host</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> headers</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> querys</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HttpResponse <span class="title">doGet</span><span class="params">(String host, String path, String method,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     Map&lt;String, String&gt; headers,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     Map&lt;String, String&gt; querys)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HttpClient httpClient = wrapClient(host);</span><br><span class="line"></span><br><span class="line">        HttpGet request = <span class="keyword">new</span> HttpGet(buildUrl(host, path, querys));</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; e : headers.entrySet()) &#123;</span><br><span class="line">            request.addHeader(e.getKey(), e.getValue());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> httpClient.execute(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * post form</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> host</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> headers</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> querys</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bodys</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HttpResponse <span class="title">doPost</span><span class="params">(String host, String path, String method,</span></span></span><br><span class="line"><span class="function"><span class="params">                                      Map&lt;String, String&gt; headers,</span></span></span><br><span class="line"><span class="function"><span class="params">                                      Map&lt;String, String&gt; querys,</span></span></span><br><span class="line"><span class="function"><span class="params">                                      Map&lt;String, String&gt; bodys)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HttpClient httpClient = wrapClient(host);</span><br><span class="line"></span><br><span class="line">        HttpPost request = <span class="keyword">new</span> HttpPost(buildUrl(host, path, querys));</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; e : headers.entrySet()) &#123;</span><br><span class="line">            request.addHeader(e.getKey(), e.getValue());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (bodys != <span class="keyword">null</span>) &#123;</span><br><span class="line">            List&lt;NameValuePair&gt; nameValuePairList = <span class="keyword">new</span> ArrayList&lt;NameValuePair&gt;();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (String key : bodys.keySet()) &#123;</span><br><span class="line">                nameValuePairList.add(<span class="keyword">new</span> BasicNameValuePair(key, bodys.get(key)));</span><br><span class="line">            &#125;</span><br><span class="line">            UrlEncodedFormEntity formEntity = <span class="keyword">new</span> UrlEncodedFormEntity(nameValuePairList, <span class="string">"utf-8"</span>);</span><br><span class="line">            formEntity.setContentType(<span class="string">"application/x-www-form-urlencoded; charset=UTF-8"</span>);</span><br><span class="line">            request.setEntity(formEntity);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> httpClient.execute(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Post String</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> host</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> headers</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> querys</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> body</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HttpResponse <span class="title">doPost</span><span class="params">(String host, String path, String method,</span></span></span><br><span class="line"><span class="function"><span class="params">                                      Map&lt;String, String&gt; headers,</span></span></span><br><span class="line"><span class="function"><span class="params">                                      Map&lt;String, String&gt; querys,</span></span></span><br><span class="line"><span class="function"><span class="params">                                      String body)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HttpClient httpClient = wrapClient(host);</span><br><span class="line"></span><br><span class="line">        HttpPost request = <span class="keyword">new</span> HttpPost(buildUrl(host, path, querys));</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; e : headers.entrySet()) &#123;</span><br><span class="line">            request.addHeader(e.getKey(), e.getValue());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotBlank(body)) &#123;</span><br><span class="line">            request.setEntity(<span class="keyword">new</span> StringEntity(body, <span class="string">"utf-8"</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> httpClient.execute(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Post stream</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> host</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> headers</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> querys</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> body</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HttpResponse <span class="title">doPost</span><span class="params">(String host, String path, String method,</span></span></span><br><span class="line"><span class="function"><span class="params">                                      Map&lt;String, String&gt; headers,</span></span></span><br><span class="line"><span class="function"><span class="params">                                      Map&lt;String, String&gt; querys,</span></span></span><br><span class="line"><span class="function"><span class="params">                                      <span class="keyword">byte</span>[] body)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HttpClient httpClient = wrapClient(host);</span><br><span class="line"></span><br><span class="line">        HttpPost request = <span class="keyword">new</span> HttpPost(buildUrl(host, path, querys));</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; e : headers.entrySet()) &#123;</span><br><span class="line">            request.addHeader(e.getKey(), e.getValue());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (body != <span class="keyword">null</span>) &#123;</span><br><span class="line">            request.setEntity(<span class="keyword">new</span> ByteArrayEntity(body));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> httpClient.execute(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Put String</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> host</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> headers</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> querys</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> body</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HttpResponse <span class="title">doPut</span><span class="params">(String host, String path, String method,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     Map&lt;String, String&gt; headers,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     Map&lt;String, String&gt; querys,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     String body)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HttpClient httpClient = wrapClient(host);</span><br><span class="line"></span><br><span class="line">        HttpPut request = <span class="keyword">new</span> HttpPut(buildUrl(host, path, querys));</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; e : headers.entrySet()) &#123;</span><br><span class="line">            request.addHeader(e.getKey(), e.getValue());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotBlank(body)) &#123;</span><br><span class="line">            request.setEntity(<span class="keyword">new</span> StringEntity(body, <span class="string">"utf-8"</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> httpClient.execute(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Put stream</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> host</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> headers</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> querys</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> body</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HttpResponse <span class="title">doPut</span><span class="params">(String host, String path, String method,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     Map&lt;String, String&gt; headers,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     Map&lt;String, String&gt; querys,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     <span class="keyword">byte</span>[] body)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HttpClient httpClient = wrapClient(host);</span><br><span class="line"></span><br><span class="line">        HttpPut request = <span class="keyword">new</span> HttpPut(buildUrl(host, path, querys));</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; e : headers.entrySet()) &#123;</span><br><span class="line">            request.addHeader(e.getKey(), e.getValue());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (body != <span class="keyword">null</span>) &#123;</span><br><span class="line">            request.setEntity(<span class="keyword">new</span> ByteArrayEntity(body));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> httpClient.execute(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Delete</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> host</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> headers</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> querys</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HttpResponse <span class="title">doDelete</span><span class="params">(String host, String path, String method,</span></span></span><br><span class="line"><span class="function"><span class="params">                                        Map&lt;String, String&gt; headers,</span></span></span><br><span class="line"><span class="function"><span class="params">                                        Map&lt;String, String&gt; querys)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HttpClient httpClient = wrapClient(host);</span><br><span class="line"></span><br><span class="line">        HttpDelete request = <span class="keyword">new</span> HttpDelete(buildUrl(host, path, querys));</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; e : headers.entrySet()) &#123;</span><br><span class="line">            request.addHeader(e.getKey(), e.getValue());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> httpClient.execute(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">buildUrl</span><span class="params">(String host, String path, Map&lt;String, String&gt; querys)</span> <span class="keyword">throws</span> UnsupportedEncodingException </span>&#123;</span><br><span class="line">        StringBuilder sbUrl = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        sbUrl.append(host);</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isBlank(path)) &#123;</span><br><span class="line">            sbUrl.append(path);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != querys) &#123;</span><br><span class="line">            StringBuilder sbQuery = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">            <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; query : querys.entrySet()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="number">0</span> &lt; sbQuery.length()) &#123;</span><br><span class="line">                    sbQuery.append(<span class="string">"&amp;"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (StringUtils.isBlank(query.getKey()) &amp;&amp; !StringUtils.isBlank(query.getValue())) &#123;</span><br><span class="line">                    sbQuery.append(query.getValue());</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (!StringUtils.isBlank(query.getKey())) &#123;</span><br><span class="line">                    sbQuery.append(query.getKey());</span><br><span class="line">                    <span class="keyword">if</span> (!StringUtils.isBlank(query.getValue())) &#123;</span><br><span class="line">                        sbQuery.append(<span class="string">"="</span>);</span><br><span class="line">                        sbQuery.append(URLEncoder.encode(query.getValue(), <span class="string">"utf-8"</span>));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="number">0</span> &lt; sbQuery.length()) &#123;</span><br><span class="line">                sbUrl.append(<span class="string">"?"</span>).append(sbQuery);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sbUrl.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> HttpClient <span class="title">wrapClient</span><span class="params">(String host)</span> </span>&#123;</span><br><span class="line">        HttpClient httpClient = <span class="keyword">new</span> DefaultHttpClient();</span><br><span class="line">        <span class="keyword">if</span> (host.startsWith(<span class="string">"https://"</span>)) &#123;</span><br><span class="line">            sslClient(httpClient);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> httpClient;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sslClient</span><span class="params">(HttpClient httpClient)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            SSLContext ctx = SSLContext.getInstance(<span class="string">"TLS"</span>);</span><br><span class="line">            X509TrustManager tm = <span class="keyword">new</span> X509TrustManager() &#123;</span><br><span class="line">                <span class="keyword">public</span> X509Certificate[] getAcceptedIssuers() &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkClientTrusted</span><span class="params">(X509Certificate[] xcs, String str)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkServerTrusted</span><span class="params">(X509Certificate[] xcs, String str)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">            ctx.init(<span class="keyword">null</span>, <span class="keyword">new</span> TrustManager[] &#123; tm &#125;, <span class="keyword">null</span>);</span><br><span class="line">            SSLSocketFactory ssf = <span class="keyword">new</span> SSLSocketFactory(ctx);</span><br><span class="line">            ssf.setHostnameVerifier(SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);</span><br><span class="line">            ClientConnectionManager ccm = httpClient.getConnectionManager();</span><br><span class="line">            SchemeRegistry registry = ccm.getSchemeRegistry();</span><br><span class="line">            registry.register(<span class="keyword">new</span> Scheme(<span class="string">"https"</span>, <span class="number">443</span>, ssf));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (KeyManagementException ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(ex);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="SmsTest"><a href="#SmsTest" class="headerlink" title="SmsTest"></a>SmsTest</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.fanke.sms.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fanke.sms.util.HttpUtil;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.net.HttpURLConnection;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SmsTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String host = <span class="string">"http://yzx.market.alicloudapi.com"</span>;</span><br><span class="line">        String path = <span class="string">"/yzx/sendSms"</span>;</span><br><span class="line">        String method = <span class="string">"POST"</span>;</span><br><span class="line">        String appcode = <span class="string">"你自己的AppCode"</span>;</span><br><span class="line">	    Map&lt;String, String&gt; headers = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">	    <span class="comment">//最后在header中的格式(中间是英文空格)为Authorization:APPCODE 83359fd73fe94948385f570e3c139105</span></span><br><span class="line">	    headers.put(<span class="string">"Authorization"</span>, <span class="string">"APPCODE "</span> + appcode);</span><br><span class="line">	    Map&lt;String, String&gt; querys = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">	    querys.put(<span class="string">"mobile"</span>, <span class="string">"15905351199"</span>);</span><br><span class="line">	    querys.put(<span class="string">"param"</span>, <span class="string">"code:1234"</span>);</span><br><span class="line">	    querys.put(<span class="string">"tpl_id"</span>, <span class="string">"TP1710262"</span>);</span><br><span class="line">        Map&lt;String, String&gt; bodys = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 重要提示如下:</span></span><br><span class="line"><span class="comment">             * HttpUtils请从</span></span><br><span class="line"><span class="comment">             * https://github.com/aliyun/api-gateway-demo-sign-java/blob/master/src/main/java/com/aliyun/api/gateway/demo/util/HttpUtils.java</span></span><br><span class="line"><span class="comment">             * 下载</span></span><br><span class="line"><span class="comment">             *</span></span><br><span class="line"><span class="comment">             * 相应的依赖请参照</span></span><br><span class="line"><span class="comment">             * https://github.com/aliyun/api-gateway-demo-sign-java/blob/master/pom.xml</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            HttpResponse response = HttpUtil.doPost(host, path, method, headers, querys, bodys);</span><br><span class="line">            System.out.println(response.toString());</span><br><span class="line">            <span class="comment">//获取response的body</span></span><br><span class="line">            <span class="comment">//System.out.println(EntityUtils.toString(response.getEntity()));</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="然后ok了"><a href="#然后ok了" class="headerlink" title="然后ok了"></a>然后ok了</h4>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://fankekeke.club/2019/01/14/三网短信验证码API/" data-id="cjrabl6r90037vkdqv75dfdm5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/API/">API</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Quartz" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/11/Quartz/" class="article-date">
  <time datetime="2019-01-11T01:35:29.000Z" itemprop="datePublished">2019-01-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java工具与中间件/">Java工具与中间件</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/11/Quartz/">Quartz</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="介绍Quartz"><a href="#介绍Quartz" class="headerlink" title="介绍Quartz"></a>介绍Quartz</h3><p>Quartz是一个任务调度框架。在某一个有规律的时间点干某件事。并且时间的触发的条件可以非常复杂（比如每月最后一个工作日的17:50），复杂到需要一个专门的框架来干这个事。 Quartz就是来干这样的事，你给它一个触发条件的定义，它负责到了时间点，触发相应的Job起来干活。</p>
<h3 id="框架搭建"><a href="#框架搭建" class="headerlink" title="框架搭建"></a>框架搭建</h3><h4 id="导入Quartz的相关jar包"><a href="#导入Quartz的相关jar包" class="headerlink" title="导入Quartz的相关jar包"></a>导入Quartz的相关jar包</h4><p><strong>slf4j-log4j12-1.7.7.jar<br>quartz-jobs-2.2.3.jar<br>quartz-2.2.3.jar<br>c3p0-0.9.1.1.jar<br>log4j-1.2.16.jar<br>slf4j-api-1.7.7.jar</strong></p>
<h4 id="TestQuartz"><a href="#TestQuartz" class="headerlink" title="TestQuartz"></a>TestQuartz</h4><p>触发器 Trigger： 什么时候工作<br>任务 Job: 做什么工作<br>调度器 Scheduler: 搭配 Trigger和Job<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestQuartz</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">            <span class="comment">//创建调度器</span></span><br><span class="line">            Scheduler scheduler = StdSchedulerFactory.getDefaultScheduler();</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//定义一个触发器</span></span><br><span class="line">            Trigger trigger = newTrigger().withIdentity(<span class="string">"trigger1"</span>, <span class="string">"group1"</span>) <span class="comment">//定义名称和所属的组</span></span><br><span class="line">                .startNow()</span><br><span class="line">                .withSchedule(simpleSchedule()</span><br><span class="line">                    .withIntervalInSeconds(<span class="number">2</span>) <span class="comment">//每隔2秒执行一次</span></span><br><span class="line">                    .withRepeatCount(<span class="number">10</span>)) <span class="comment">//总共执行11次(第一次执行不基数)</span></span><br><span class="line">                .build();</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//定义一个JobDetail</span></span><br><span class="line">            JobDetail job = newJob(MailJob.class) <span class="comment">//指定干活的类MailJob</span></span><br><span class="line">                .withIdentity(<span class="string">"mailjob1"</span>, <span class="string">"mailgroup"</span>) <span class="comment">//定义任务名称和分组</span></span><br><span class="line">                .usingJobData(<span class="string">"email"</span>, <span class="string">"admin@10086.com"</span>) <span class="comment">//定义属性</span></span><br><span class="line">                .build();</span><br><span class="line">             </span><br><span class="line">            <span class="comment">//调度加入这个job</span></span><br><span class="line">            scheduler.scheduleJob(job, trigger);</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//启动</span></span><br><span class="line">            scheduler.start();</span><br><span class="line">             </span><br><span class="line">            <span class="comment">//等待20秒，让前面的任务都执行完了之后，再关闭调度器</span></span><br><span class="line">            Thread.sleep(<span class="number">20000</span>);</span><br><span class="line">            scheduler.shutdown(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="MailJob"><a href="#MailJob" class="headerlink" title="MailJob"></a>MailJob</h4><p>MailJob 实现了 Job 接口，提供 execute<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MailJob</span> <span class="keyword">implements</span> <span class="title">Job</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(JobExecutionContext context)</span> <span class="keyword">throws</span> JobExecutionException </span>&#123;</span><br><span class="line">        JobDetail detail = context.getJobDetail();</span><br><span class="line">        String email = detail.getJobDataMap().getString(<span class="string">"email"</span>);</span><br><span class="line">         </span><br><span class="line">        SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"HH:mm:ss"</span>);</span><br><span class="line">        String now = sdf.format(<span class="keyword">new</span>  Date());</span><br><span class="line">         </span><br><span class="line">        System.out.printf(<span class="string">"给邮件地址 %s 发出了一封定时邮件, 当前时间是: %s%n"</span> ,email, now);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.withIdentity(<span class="string">"mailjob1"</span>, <span class="string">"mailgroup"</span>)</span><br></pre></td></tr></table></figure>
<p> 比如一个系统有3个job 是备份数据库的，有4个job 是发邮件的，那么对他们进行分组，可以方便管理，类似于一次性停止所有发邮件的这样的操作</p>
<h4 id="log4j-xml"><a href="#log4j-xml" class="headerlink" title="log4j.xml"></a>log4j.xml</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE log4j:configuration SYSTEM <span class="string">"log4j.dtd"</span>&gt;</span><br><span class="line"> </span><br><span class="line">&lt;log4j:configuration xmlns:log4j=<span class="string">"http://jakarta.apache.org/log4j/"</span>&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;appender name=<span class="string">"default"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.apache.log4j.ConsoleAppender"</span>&gt;</span><br><span class="line">    &lt;param name=<span class="string">"target"</span> value=<span class="string">"System.out"</span>/&gt;</span><br><span class="line">    &lt;layout <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.apache.log4j.PatternLayout"</span>&gt;</span><br><span class="line">      &lt;param name=<span class="string">"ConversionPattern"</span> value=<span class="string">"[%p] %d&#123;dd MMM hh:mm:ss.SSS aa&#125; %t [%c]%n%m%n%n"</span>/&gt;</span><br><span class="line">    &lt;/layout&gt;</span><br><span class="line">  &lt;/appender&gt;</span><br><span class="line"> </span><br><span class="line"> &lt;logger name=<span class="string">"com.how2java"</span>&gt;</span><br><span class="line">   &lt;level value=<span class="string">"error"</span> /&gt;</span><br><span class="line"> &lt;/logger&gt;</span><br><span class="line"> </span><br><span class="line">  &lt;root&gt;</span><br><span class="line">    &lt;level value=<span class="string">"error"</span> /&gt;</span><br><span class="line">    &lt;appender-ref ref=<span class="string">"default"</span> /&gt;</span><br><span class="line">  &lt;/root&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/log4j:configuration&gt;</span><br></pre></td></tr></table></figure>
<h3 id="Job管理"><a href="#Job管理" class="headerlink" title="Job管理"></a>Job管理</h3><h4 id="Job组成部分"><a href="#Job组成部分" class="headerlink" title="Job组成部分"></a>Job组成部分</h4><p>JobDetail: 用于描述这个Job是做什么的<br>实现Job的类: 具体干活的<br>JobDataMap: 给 Job 提供参数用的</p>
<p>JobDataMap 除了usingJobData 方式之外，还可以是其他方式，像这样<br> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">job.getJobDataMap().put(<span class="string">"email"</span>, <span class="string">"admin@taobao.com"</span>);</span><br></pre></td></tr></table></figure></p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">jobDataMap</span><span class="params">()</span> <span class="keyword">throws</span> SchedulerException, InterruptedException </span>&#123;</span><br><span class="line">      Scheduler scheduler = StdSchedulerFactory.getDefaultScheduler();</span><br><span class="line"></span><br><span class="line">      Trigger trigger = newTrigger().withIdentity(<span class="string">"trigger1"</span>, <span class="string">"group1"</span>)</span><br><span class="line">          .startNow()</span><br><span class="line">          .withSchedule(simpleSchedule()</span><br><span class="line">              .withIntervalInSeconds(<span class="number">2</span>)</span><br><span class="line">              .withRepeatCount(<span class="number">10</span>))</span><br><span class="line">          .build();</span><br><span class="line"></span><br><span class="line">      <span class="comment">//定义一个JobDetail</span></span><br><span class="line">      JobDetail job = newJob(MailJob.class)</span><br><span class="line">          .withIdentity(<span class="string">"mailjob1"</span>, <span class="string">"mailgroup"</span>)</span><br><span class="line">          .usingJobData(<span class="string">"email"</span>, <span class="string">"admin@10086.com"</span>)</span><br><span class="line">          .build();</span><br><span class="line">       </span><br><span class="line">      <span class="comment">//用JobDataMap 修改email</span></span><br><span class="line">      job.getJobDataMap().put(<span class="string">"email"</span>, <span class="string">"admin@taobao.com"</span>);</span><br><span class="line">       </span><br><span class="line">      <span class="comment">//调度加入这个job</span></span><br><span class="line">      scheduler.scheduleJob(job, trigger);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//启动</span></span><br><span class="line">      scheduler.start();</span><br><span class="line">        </span><br><span class="line">      <span class="comment">//等待20秒，让前面的任务都执行完了之后，再关闭调度器</span></span><br><span class="line">      Thread.sleep(<span class="number">20000</span>);</span><br><span class="line">      scheduler.shutdown(<span class="keyword">true</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="Job并发"><a href="#Job并发" class="headerlink" title="Job并发"></a>Job并发</h4><p> 默认的情况下，无论上一次任务是否结束或者完成，只要规定的时间到了，那么下一次就开始。</p>
<p>有时候会做长时间的任务，比如数据库备份，这个时候就希望上一次备份成功结束之后，才开始下一次备份，即便是规定时间到了，也不能开始，因为这样很有可能造成 数据库被锁死 （几个线程同时备份数据库，引发无法预计的混乱）。</p>
<p>那么在这种情况下，给数据库备份任务增加一个注解就好了<br><strong>@DisallowConcurrentExecution </strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DisallowConcurrentExecution</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DatabaseBackupJob</span> <span class="keyword">implements</span> <span class="title">Job</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(JobExecutionContext context)</span> <span class="keyword">throws</span> JobExecutionException </span>&#123;</span><br><span class="line">        JobDetail detail = context.getJobDetail();</span><br><span class="line">        String database = detail.getJobDataMap().getString(<span class="string">"database"</span>);</span><br><span class="line">         </span><br><span class="line">        System.out.printf(<span class="string">"给数据库 %s 备份, 耗时10秒 %n"</span> ,database);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">10000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="Job异常"><a href="#Job异常" class="headerlink" title="Job异常"></a>Job异常</h4><p>任务里发生异常是很常见的。 异常处理办法通常是两种： </p>
<h5 id="当异常发生，那么就通知所有管理这个-Job-的调度，停止运行它"><a href="#当异常发生，那么就通知所有管理这个-Job-的调度，停止运行它" class="headerlink" title="当异常发生，那么就通知所有管理这个 Job 的调度，停止运行它"></a>当异常发生，那么就通知所有管理这个 Job 的调度，停止运行它</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExceptionJob1</span>  <span class="keyword">implements</span> <span class="title">Job</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(JobExecutionContext context)</span> <span class="keyword">throws</span> JobExecutionException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//故意发生异常</span></span><br><span class="line">            System.out.println(<span class="number">100</span>/i);</span><br><span class="line">             </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"发生了异常，取消这个Job 对应的所有调度"</span>);</span><br><span class="line">            JobExecutionException je =<span class="keyword">new</span> JobExecutionException(e);</span><br><span class="line">            je.setUnscheduleAllTriggers(<span class="keyword">true</span>);</span><br><span class="line">            <span class="keyword">throw</span> je;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="当异常发生，修改一下参数，马上重新运行"><a href="#当异常发生，修改一下参数，马上重新运行" class="headerlink" title="当异常发生，修改一下参数，马上重新运行"></a>当异常发生，修改一下参数，马上重新运行</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExceptionJob2</span>  <span class="keyword">implements</span> <span class="title">Job</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(JobExecutionContext context)</span> <span class="keyword">throws</span> JobExecutionException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//故意发生异常</span></span><br><span class="line">            System.out.println(<span class="string">"运算结果"</span>+<span class="number">100</span>/i);</span><br><span class="line">             </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"发生了异常，修改一下参数，立即重新执行"</span>);</span><br><span class="line">            i = <span class="number">1</span>;</span><br><span class="line">            JobExecutionException je =<span class="keyword">new</span> JobExecutionException(e);</span><br><span class="line">            je.setRefireImmediately(<span class="keyword">true</span>);</span><br><span class="line">            <span class="keyword">throw</span> je;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="中断-Job"><a href="#中断-Job" class="headerlink" title="中断 Job"></a>中断 Job</h4><p>这个Job需要实现 InterruptableJob 接口，然后就方便中断了<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//必须实现InterruptableJob 而非 Job才能够被中断</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StoppableJob</span> <span class="keyword">implements</span> <span class="title">InterruptableJob</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> stop = <span class="keyword">false</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(JobExecutionContext context)</span> <span class="keyword">throws</span> JobExecutionException </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span>(stop)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">"每隔1秒，进行一次检测，看看是否停止"</span>);</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"持续工作中。。。"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">     </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">interrupt</span><span class="params">()</span> <span class="keyword">throws</span> UnableToInterruptJobException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"被调度叫停"</span>);</span><br><span class="line">        stop = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p><strong>运作终止方法</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Scheduler scheduler = StdSchedulerFactory.getDefaultScheduler();</span><br><span class="line">          </span><br><span class="line">        Trigger trigger = newTrigger().withIdentity(<span class="string">"trigger1"</span>, <span class="string">"group1"</span>)</span><br><span class="line">            .startNow()</span><br><span class="line">            .build();</span><br><span class="line">  </span><br><span class="line">        <span class="comment">//定义一个JobDetail</span></span><br><span class="line">        JobDetail job = newJob(StoppableJob.class)</span><br><span class="line">            .withIdentity(<span class="string">"exceptionJob1"</span>, <span class="string">"someJobGroup"</span>)</span><br><span class="line">            .build();</span><br><span class="line">          </span><br><span class="line">        <span class="comment">//调度加入这个job</span></span><br><span class="line">        scheduler.scheduleJob(job, trigger);</span><br><span class="line">  </span><br><span class="line">        <span class="comment">//启动</span></span><br><span class="line">        scheduler.start();</span><br><span class="line">     </span><br><span class="line">        Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">        System.out.println(<span class="string">"过5秒，调度停止 job"</span>);</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//key 就相当于这个Job的主键</span></span><br><span class="line">        scheduler.interrupt(job.getKey());</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//等待20秒，让前面的任务都执行完了之后，再关闭调度器</span></span><br><span class="line">        Thread.sleep(<span class="number">20000</span>);</span><br><span class="line">        scheduler.shutdown(<span class="keyword">true</span>);  </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="SimpleTrigger"><a href="#SimpleTrigger" class="headerlink" title="SimpleTrigger"></a>SimpleTrigger</h3><p>Trigger 就是触发器的意思，用来指定什么时间开始触发，触发多少次，每隔多久触发一次.<br>SimpleTrigger 可以方便的实现一系列的触发机制。</p>
<h4 id="下一个8秒的倍数"><a href="#下一个8秒的倍数" class="headerlink" title="下一个8秒的倍数"></a>下一个8秒的倍数</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">           Scheduler scheduler = StdSchedulerFactory.getDefaultScheduler();</span><br><span class="line"> </span><br><span class="line">           Date startTime = DateBuilder.nextGivenSecondDate(<span class="keyword">null</span>, <span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">           JobDetail job = newJob(MailJob.class).withIdentity(<span class="string">"mailJob"</span>, <span class="string">"mailGroup"</span>).build();</span><br><span class="line"></span><br><span class="line">           SimpleTrigger trigger = (SimpleTrigger) newTrigger().withIdentity(<span class="string">"trigger1"</span>, <span class="string">"group1"</span>).startAt(startTime).build();</span><br><span class="line"></span><br><span class="line">           <span class="comment">// schedule it to run!</span></span><br><span class="line">           Date ft = scheduler.scheduleJob(job, trigger);</span><br><span class="line">            </span><br><span class="line">           System.out.println(<span class="string">"当前时间是："</span> + <span class="keyword">new</span> Date().toLocaleString());</span><br><span class="line">           System.out.printf(<span class="string">"%s 这个任务会在 %s 准时开始运行，累计运行%d次，间隔时间是%d毫秒%n"</span>, job.getKey(), ft.toLocaleString(), trigger.getRepeatCount()+<span class="number">1</span>, trigger.getRepeatInterval());</span><br><span class="line">           </span><br><span class="line">           scheduler.start();</span><br><span class="line">             </span><br><span class="line">           <span class="comment">//等待200秒，让前面的任务都执行完了之后，再关闭调度器</span></span><br><span class="line">           Thread.sleep(<span class="number">200000</span>);</span><br><span class="line">           scheduler.shutdown(<span class="keyword">true</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h4 id="10-秒后运行"><a href="#10-秒后运行" class="headerlink" title="10 秒后运行"></a>10 秒后运行</h4><p><strong>DateBuilder.futureDate()</strong></p>
<p>可以方便的获取10秒后， 5分钟后， 3个小时候，2个月后这样的时间<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">            Scheduler scheduler = StdSchedulerFactory.getDefaultScheduler();</span><br><span class="line">   </span><br><span class="line">            Date startTime = DateBuilder.futureDate(<span class="number">10</span>, IntervalUnit.SECOND);</span><br><span class="line">             </span><br><span class="line">            JobDetail job = newJob(MailJob.class).withIdentity(<span class="string">"mailJob"</span>, <span class="string">"mailGroup"</span>).build();</span><br><span class="line">  </span><br><span class="line">            SimpleTrigger trigger = (SimpleTrigger) newTrigger().withIdentity(<span class="string">"trigger1"</span>, <span class="string">"group1"</span>).startAt(startTime).build();</span><br><span class="line">  </span><br><span class="line">            <span class="comment">// schedule it to run!</span></span><br><span class="line">            Date ft = scheduler.scheduleJob(job, trigger);</span><br><span class="line">              </span><br><span class="line">            System.out.println(<span class="string">"当前时间是："</span> + <span class="keyword">new</span> Date().toLocaleString());</span><br><span class="line">            System.out.printf(<span class="string">"%s 这个任务会在 %s 准时开始运行，累计运行%d次，间隔时间是%d毫秒%n"</span>, job.getKey(), ft.toLocaleString(), trigger.getRepeatCount()+<span class="number">1</span>, trigger.getRepeatInterval());</span><br><span class="line">             </span><br><span class="line">            scheduler.start();</span><br><span class="line">               </span><br><span class="line">            <span class="comment">//等待200秒，让前面的任务都执行完了之后，再关闭调度器</span></span><br><span class="line">            Thread.sleep(<span class="number">200000</span>);</span><br><span class="line">            scheduler.shutdown(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="累计n次，间隔n秒"><a href="#累计n次，间隔n秒" class="headerlink" title="累计n次，间隔n秒"></a>累计n次，间隔n秒</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">            Scheduler scheduler = StdSchedulerFactory.getDefaultScheduler();</span><br><span class="line">  </span><br><span class="line">            Date startTime = DateBuilder.nextGivenSecondDate(<span class="keyword">null</span>, <span class="number">8</span>);</span><br><span class="line"> </span><br><span class="line">            JobDetail job = newJob(MailJob.class).withIdentity(<span class="string">"mailJob"</span>, <span class="string">"mailGroup"</span>).build();</span><br><span class="line"> </span><br><span class="line">            SimpleTrigger trigger = (SimpleTrigger) newTrigger()</span><br><span class="line">                    .withIdentity(<span class="string">"trigger1"</span>, <span class="string">"group1"</span>)</span><br><span class="line">                    .startAt(startTime)</span><br><span class="line">                    .withSchedule(simpleSchedule()</span><br><span class="line">                            .withRepeatCount(<span class="number">3</span>)</span><br><span class="line">                            .withIntervalInSeconds(<span class="number">1</span>))</span><br><span class="line">                    .build();</span><br><span class="line"> </span><br><span class="line">            <span class="comment">// schedule it to run!</span></span><br><span class="line">            Date ft = scheduler.scheduleJob(job, trigger);</span><br><span class="line">             </span><br><span class="line">            System.out.println(<span class="string">"当前时间是："</span> + <span class="keyword">new</span> Date().toLocaleString());</span><br><span class="line">            System.out.printf(<span class="string">"%s 这个任务会在 %s 准时开始运行，累计运行%d次，间隔时间是%d毫秒%n"</span>, job.getKey(), ft.toLocaleString(), trigger.getRepeatCount()+<span class="number">1</span>, trigger.getRepeatInterval());</span><br><span class="line">            </span><br><span class="line">            scheduler.start();</span><br><span class="line">              </span><br><span class="line">            <span class="comment">//等待200秒，让前面的任务都执行完了之后，再关闭调度器</span></span><br><span class="line">            Thread.sleep(<span class="number">200000</span>);</span><br><span class="line">            scheduler.shutdown(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="无限重复，间隔1秒"><a href="#无限重复，间隔1秒" class="headerlink" title="无限重复，间隔1秒"></a>无限重复，间隔1秒</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">           Scheduler scheduler = StdSchedulerFactory.getDefaultScheduler();</span><br><span class="line">  </span><br><span class="line">           Date startTime = DateBuilder.nextGivenSecondDate(<span class="keyword">null</span>, <span class="number">8</span>);</span><br><span class="line"> </span><br><span class="line">           JobDetail job = newJob(MailJob.class).withIdentity(<span class="string">"mailJob"</span>, <span class="string">"mailGroup"</span>).build();</span><br><span class="line"> </span><br><span class="line">           SimpleTrigger trigger = (SimpleTrigger) newTrigger()</span><br><span class="line">                   .withIdentity(<span class="string">"trigger1"</span>, <span class="string">"group1"</span>)</span><br><span class="line">                   .startAt(startTime)</span><br><span class="line">                   .withSchedule(simpleSchedule()</span><br><span class="line">                           .repeatForever()</span><br><span class="line">                           .withIntervalInSeconds(<span class="number">1</span>))</span><br><span class="line">                   .build();</span><br><span class="line"> </span><br><span class="line">           <span class="comment">// schedule it to run!</span></span><br><span class="line">           Date ft = scheduler.scheduleJob(job, trigger);</span><br><span class="line">             </span><br><span class="line">           System.out.println(<span class="string">"当前时间是："</span> + <span class="keyword">new</span> Date().toLocaleString());</span><br><span class="line">           System.out.printf(<span class="string">"%s 这个任务会在 %s 准时开始运行，累计运行%d次，间隔时间是%d毫秒%n"</span>, job.getKey(), ft.toLocaleString(), trigger.getRepeatCount()+<span class="number">1</span>, trigger.getRepeatInterval());</span><br><span class="line">            </span><br><span class="line">           scheduler.start();</span><br><span class="line">              </span><br><span class="line">           <span class="comment">//等待200秒，让前面的任务都执行完了之后，再关闭调度器</span></span><br><span class="line">           Thread.sleep(<span class="number">200000</span>);</span><br><span class="line">           scheduler.shutdown(<span class="keyword">true</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h3 id="CronTrigger"><a href="#CronTrigger" class="headerlink" title="CronTrigger"></a>CronTrigger</h3><p>Cron 是Linux下的一个定时器，功能很强大，但是表达式更为复杂<br>CronTrigger 就是用 Cron 表达式来安排触发时间和次数的。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">            Scheduler scheduler = StdSchedulerFactory.getDefaultScheduler();</span><br><span class="line">   </span><br><span class="line">            Date startTime = DateBuilder.nextGivenSecondDate(<span class="keyword">null</span>, <span class="number">8</span>);</span><br><span class="line">  </span><br><span class="line">            JobDetail job = newJob(MailJob.class).withIdentity(<span class="string">"mailJob"</span>, <span class="string">"mailGroup"</span>).build();</span><br><span class="line">  </span><br><span class="line">            CronTrigger trigger = newTrigger().withIdentity(<span class="string">"trigger1"</span>, <span class="string">"group1"</span>).withSchedule(cronSchedule(<span class="string">"0/2 * * * * ?"</span>))</span><br><span class="line">                    .build();</span><br><span class="line">  </span><br><span class="line">            <span class="comment">// schedule it to run!</span></span><br><span class="line">            Date ft = scheduler.scheduleJob(job, trigger);</span><br><span class="line">             </span><br><span class="line">            System.out.println(<span class="string">"使用的Cron表达式是："</span>+trigger.getCronExpression());</span><br><span class="line"><span class="comment">//            System.out.printf("%s 这个任务会在 %s 准时开始运行，累计运行%d次，间隔时间是%d毫秒%n", job.getKey(), ft.toLocaleString(), trigger.getRepeatCount()+1, trigger.getRepeatInterval());</span></span><br><span class="line">             </span><br><span class="line">            scheduler.start();</span><br><span class="line">               </span><br><span class="line">            <span class="comment">//等待200秒，让前面的任务都执行完了之后，再关闭调度器</span></span><br><span class="line">            Thread.sleep(<span class="number">200000</span>);</span><br><span class="line">            scheduler.shutdown(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>这里有个Cron表达式生成工具，可以参考一下：</strong> <a href="http://cron.qqe2.com/" target="_blank" rel="noopener">http://cron.qqe2.com/</a></p>
<h3 id="Listener"><a href="#Listener" class="headerlink" title="Listener"></a>Listener</h3><p>Quartz 的监听器有Job监听器，Trigger监听器， Scheduler监听器，对不同层面进行监控。 实际业务用的较多的是Job监听器，用于监听器是否执行了</p>
<h4 id="MailJobListener"><a href="#MailJobListener" class="headerlink" title="MailJobListener"></a>MailJobListener</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MailJobListener</span> <span class="keyword">implements</span> <span class="title">JobListener</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"listener of mail job"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jobExecutionVetoed</span><span class="params">(JobExecutionContext context)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        System.out.println(<span class="string">"取消执行：\t "</span>+context.getJobDetail().getKey());</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jobToBeExecuted</span><span class="params">(JobExecutionContext context)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        System.out.println(<span class="string">"准备执行：\t "</span>+context.getJobDetail().getKey());</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jobWasExecuted</span><span class="params">(JobExecutionContext context, JobExecutionException arg1)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        System.out.println(<span class="string">"执行结束：\t "</span>+context.getJobDetail().getKey());</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>必须实现这四个方法</strong></p>
<h4 id="增加监听器"><a href="#增加监听器" class="headerlink" title="增加监听器"></a>增加监听器</h4><p>mailJob是当前JobDetail的对象<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//增加Job监听</span></span><br><span class="line">MailJobListener mailJobListener= <span class="keyword">new</span> MailJobListener();</span><br><span class="line">KeyMatcher&lt;JobKey&gt; keyMatcher = KeyMatcher.keyEquals(mailJob.getKey());</span><br><span class="line">scheduler.getListenerManager().addJobListener(mailJobListener, keyMatcher);</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fankekeke.club/2019/01/11/Quartz/" data-id="cjrabl6ny001dvkdqt94v9vx4" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-SpringBoot整合Quartz定时任务框架" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/08/SpringBoot整合Quartz定时任务框架/" class="article-date">
  <time datetime="2019-01-08T11:06:35.000Z" itemprop="datePublished">2019-01-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/SpringBoot/">SpringBoot</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/08/SpringBoot整合Quartz定时任务框架/">SpringBoot整合Quartz定时任务框架</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="Quartz的使用思路"><a href="#Quartz的使用思路" class="headerlink" title="Quartz的使用思路"></a><a href="https://baike.baidu.com/item/quartz/3643055?fr=aladdin" target="_blank" rel="noopener">Quartz</a>的使用思路</h4><blockquote>
<p>job - 任务 - 你要做什么事？<br>Trigger - 触发器 - 你什么时候去做？<br>Scheduler - 任务调度 - 你什么时候需要去做什么事？</p>
</blockquote>
<h5 id="添加-Quartz-的坐标"><a href="#添加-Quartz-的坐标" class="headerlink" title="添加 Quartz 的坐标"></a>添加 Quartz 的坐标</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Quartz 坐标 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.quartz-scheduler&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;quartz&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;2.2.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<h5 id="创建-Job-类"><a href="#创建-Job-类" class="headerlink" title="创建 Job 类"></a>创建 Job 类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 定义任务类</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuartzDemo</span> <span class="keyword">implements</span> <span class="title">Job</span> </span>&#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 任务被触发时所执行的方法</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(JobExecutionContext arg0)</span> <span class="keyword">throws</span></span></span><br><span class="line"><span class="function">JobExecutionException </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"Execute...."</span>+<span class="keyword">new</span> Date());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="写测试代码"><a href="#写测试代码" class="headerlink" title="写测试代码"></a>写测试代码</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuartzMain</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="comment">// 1.创建 Job 对象：你要做什么事？</span></span><br><span class="line">JobDetail job = JobBuilder.newJob(QuartzDemo.class).build();</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 简单的 trigger 触发时间：通过 Quartz 提供一个方法来完成简单的重复</span></span><br><span class="line"><span class="comment">调用 cron</span></span><br><span class="line"><span class="comment">* Trigger：按照 Cron 的表达式来给定触发的时间</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 2.创建 Trigger 对象：在什么时间做？</span></span><br><span class="line"><span class="comment">/*Trigger trigger =</span></span><br><span class="line"><span class="comment">TriggerBuilder.newTrigger().withSchedule(SimpleScheduleBuilder.repeatSe</span></span><br><span class="line"><span class="comment">condlyForever())</span></span><br><span class="line"><span class="comment">.build();*/</span></span><br><span class="line">Trigger trigger =</span><br><span class="line">TriggerBuilder.newTrigger().withSchedule(CronScheduleBuilder.cronSchedu</span><br><span class="line">le(<span class="string">"0/2 * * * * ?"</span>))</span><br><span class="line">.build();</span><br><span class="line"><span class="comment">// 3.创建 Scheduler 对象：在什么时间做什么事？</span></span><br><span class="line">Scheduler scheduler =</span><br><span class="line">StdSchedulerFactory.getDefaultScheduler();</span><br><span class="line">scheduler.scheduleJob(job, trigger);</span><br><span class="line"><span class="comment">//启动</span></span><br><span class="line">scheduler.start();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">``` </span><br><span class="line">#### SpringBoot整合Quartz定时框架</span><br><span class="line">##### 修改pom文件添加坐标</span><br><span class="line">``` java</span><br><span class="line">&lt;!-- springBoot 的启动器 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- springBoot 的启动器 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- Quartz 坐标 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.quartz-scheduler&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;quartz&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;2.2.1&lt;/version&gt;</span><br><span class="line">&lt;exclusions&gt;</span><br><span class="line">&lt;exclusion&gt;</span><br><span class="line">&lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;</span><br><span class="line">&lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br><span class="line">&lt;/exclusion&gt;</span><br><span class="line">&lt;/exclusions&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- 添加 Scheduled 坐标 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-context-support&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- Sprng tx 坐标 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-tx&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<h5 id="编写-Quartz-的启动类"><a href="#编写-Quartz-的启动类" class="headerlink" title="编写 Quartz 的启动类"></a>编写 Quartz 的启动类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Quartz 配置类</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuartzConfig</span> </span>&#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 1.创建 Job 对象</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> JobDetailFactoryBean <span class="title">jobDetailFactoryBean</span><span class="params">()</span></span>&#123;</span><br><span class="line">JobDetailFactoryBean factory = <span class="keyword">new</span> JobDetailFactoryBean();</span><br><span class="line"><span class="comment">//关联我们自己的 Job 类</span></span><br><span class="line">factory.setJobClass(QuartzDemo.class);</span><br><span class="line"><span class="keyword">return</span> factory;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 2.创建 Trigger 对象</span></span><br><span class="line"><span class="comment">* 简单的 Trigger</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">/*@Bean</span></span><br><span class="line"><span class="comment">public SimpleTriggerFactoryBean</span></span><br><span class="line"><span class="comment">simpleTriggerFactoryBean(JobDetailFactoryBean jobDetailFactoryBean)&#123;</span></span><br><span class="line"><span class="comment">SimpleTriggerFactoryBean factory = new</span></span><br><span class="line"><span class="comment">SimpleTriggerFactoryBean();</span></span><br><span class="line"><span class="comment">//关联 JobDetail 对象</span></span><br><span class="line"><span class="comment">factory.setJobDetail(jobDetailFactoryBean.getObject());</span></span><br><span class="line"><span class="comment">//该参数表示一个执行的毫秒数</span></span><br><span class="line"><span class="comment">factory.setRepeatInterval(2000);</span></span><br><span class="line"><span class="comment">//重复次数</span></span><br><span class="line"><span class="comment">factory.setRepeatCount(5);</span></span><br><span class="line"><span class="comment">return factory;</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Cron Trigger</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> CronTriggerFactoryBean</span><br><span class="line">cronTriggerFactoryBean(JobDetailFactoryBean jobDetailFactoryBean)&#123;</span><br><span class="line">CronTriggerFactoryBean factory = <span class="keyword">new</span> CronTriggerFactoryBean();</span><br><span class="line">factory.setJobDetail(jobDetailFactoryBean.getObject());</span><br><span class="line"><span class="comment">//设置触发时间</span></span><br><span class="line">factory.setCronExpression(<span class="string">"0/2 * * * * ?"</span>);</span><br><span class="line"><span class="keyword">return</span> factory;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 3.创建 Scheduler 对象</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> SchedulerFactoryBean</span><br><span class="line">schedulerFactoryBean(CronTriggerFactoryBean</span><br><span class="line">cronTriggerFactoryBean,MyAdaptableJobFactory myAdaptableJobFactory)&#123;</span><br><span class="line">SchedulerFactoryBean factory = <span class="keyword">new</span> SchedulerFactoryBean();</span><br><span class="line"><span class="comment">//关联 trigger</span></span><br><span class="line">factory.setTriggers(cronTriggerFactoryBean.getObject());</span><br><span class="line">factory.setJobFactory(myAdaptableJobFactory);</span><br><span class="line"><span class="keyword">return</span> factory;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="添加MyAdaptableJobFactory解决Spring注入问题"><a href="#添加MyAdaptableJobFactory解决Spring注入问题" class="headerlink" title="添加MyAdaptableJobFactory解决Spring注入问题"></a>添加MyAdaptableJobFactory解决Spring注入问题</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(<span class="string">"myAdaptableJobFactory"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAdaptableJobFactory</span> <span class="keyword">extends</span> <span class="title">AdaptableJobFactory</span> </span>&#123;</span><br><span class="line"><span class="comment">//AutowireCapableBeanFactory 可以将一个对象添加到 SpringIOC 容器中，</span></span><br><span class="line">并且完成该对象注入</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> AutowireCapableBeanFactory autowireCapableBeanFactory;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 该方法需要将实例化的任务对象手动的添加到 springIOC 容器中并且完成对</span></span><br><span class="line"><span class="comment">象的注入</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> Object <span class="title">createJobInstance</span><span class="params">(TriggerFiredBundle bundle)</span></span></span><br><span class="line"><span class="function"><span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">Object obj = <span class="keyword">super</span>.createJobInstance(bundle);</span><br><span class="line"><span class="comment">//将 obj 对象添加 Spring IOC 容器中，并完成注入</span></span><br><span class="line"><span class="keyword">this</span>.autowireCapableBeanFactory.autowireBean(obj);</span><br><span class="line"><span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://fankekeke.club/2019/01/08/SpringBoot整合Quartz定时任务框架/" data-id="cjrabl6qg0022vkdq9cny98hh" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-SpringBoot定时任务" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/08/SpringBoot定时任务/" class="article-date">
  <time datetime="2019-01-08T07:03:41.000Z" itemprop="datePublished">2019-01-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/SpringBoot/">SpringBoot</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/08/SpringBoot定时任务/">SpringBoot定时任务</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<h2 id="Scheduled定时器任务"><a href="#Scheduled定时器任务" class="headerlink" title="Scheduled定时器任务"></a>Scheduled定时器任务</h2></blockquote>
<p>Scheduled定时器任务:是Spring3.0以后自带的一个定时任务器</p>
<blockquote>
<h3 id="在pom文件中添加Scheduled的坐标"><a href="#在pom文件中添加Scheduled的坐标" class="headerlink" title="在pom文件中添加Scheduled的坐标"></a>在pom文件中添加Scheduled的坐标</h3></blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;project xmlns=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span><br><span class="line">xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">xsi:schemaLocation=<span class="string">"http://maven.apache.org/POM/4.0.0</span></span><br><span class="line"><span class="string">http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span><br><span class="line">&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line">&lt;parent&gt;</span><br><span class="line">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;1.5.10.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/parent&gt;</span><br><span class="line">&lt;groupId&gt;com.bjsxt&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;25-spring-boot-scheduled&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span><br><span class="line">&lt;properties&gt;</span><br><span class="line">&lt;java.version&gt;1.7&lt;/java.version&gt;</span><br><span class="line">&lt;thymeleaf.version&gt;3.0.2.RELEASE&lt;/thymeleaf.version&gt;</span><br><span class="line">&lt;thymeleaf-layout-dialect.version&gt;2.0.4&lt;/thymeleaf-layout-dialect.versi</span><br><span class="line">on&gt;</span><br><span class="line">&lt;/properties&gt;</span><br><span class="line">&lt;dependencies&gt;</span><br><span class="line">&lt;!-- springBoot 的启动器 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- springBoot 的启动器 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- 添加 Scheduled 坐标 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-context-support&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="编写定时任务"><a href="#编写定时任务" class="headerlink" title="编写定时任务"></a>编写定时任务</h3></blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduledDemo</span> </span>&#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 定时任务方法</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Scheduled</span>:设置定时任务</span></span><br><span class="line"><span class="comment">* cron 属性：cron 表达式。定时任务触发是时间的一个字符串表达形式</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Scheduled</span>(cron=<span class="string">"0/2 * * * * ?"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">scheduledMethod</span><span class="params">()</span></span>&#123;</span><br><span class="line">System.out.println(<span class="string">"定时器被触发"</span>+<span class="keyword">new</span> Date());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="在启动类中开启定时任务的使用"><a href="#在启动类中开启定时任务的使用" class="headerlink" title="在启动类中开启定时任务的使用"></a>在启动类中开启定时任务的使用</h3></blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">SpringApplication.run(App.class, args);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h2 id="cron表达式"><a href="#cron表达式" class="headerlink" title="cron表达式"></a>cron表达式</h2></blockquote>
<p>Cron 表达式是一个字符串，分为 6 或 7 个域，每一个域代表一个含义<br>Cron 有如下两种语法格式：<br>（1） Seconds Minutes Hours Day Month Week Year<br>（2）Seconds Minutes Hours Day Month Week</p>
<blockquote>
<h3 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h3></blockquote>
<p>corn 从左到右（用空格隔开）：秒 分 小时 月份中的日期 月份 星期中的日期 年份</p>
<blockquote>
<h3 id="名字段的含义"><a href="#名字段的含义" class="headerlink" title="名字段的含义"></a>名字段的含义</h3></blockquote>
<table>
<thead>
<tr>
<th>位置</th>
<th>时间域名</th>
<th>允许值</th>
<th>允许的特殊字符</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>秒</td>
<td>0-59</td>
<td>, - * /</td>
</tr>
<tr>
<td>2</td>
<td>分钟</td>
<td>0-59</td>
<td>, - * /</td>
</tr>
<tr>
<td>3</td>
<td>小时</td>
<td>0-23</td>
<td>, - * /</td>
</tr>
<tr>
<td>4</td>
<td>日</td>
<td>1-31</td>
<td>, - * / L W C</td>
</tr>
<tr>
<td>5</td>
<td>月</td>
<td>1-12</td>
<td>, - * /</td>
</tr>
<tr>
<td>6</td>
<td>星期</td>
<td>1-7</td>
<td>, - * ? / L C #</td>
</tr>
<tr>
<td>7</td>
<td>年(可选)</td>
<td>1970-2099</td>
<td>, - * /e</td>
</tr>
</tbody>
</table>
<p><hr><br>●星号( <em> )：可用在所有字段中，表示对应时间域的每一个时刻，例如，</em> 在分钟字段时，表示“每分钟”；<br>●问号（?）：该字符只在日期和星期字段中使用，它通常指定为“无意义的值”，相当于占位符；<br>●减号(-)：表达一个范围，如在小时字段中使用“10-12”，则表示从 10 到 12 点，即 10,11,12；<br>●逗号(,)：表达一个列表值，如在星期字段中使用“MON,WED,FRI”，则表示星期一，星期三和星期五；<br>●斜杠(/)：x/y 表达一个等步长序列，x 为起始值，y 为增量步长值。如在分钟字段中使用 0/15，则<br>表示为 0,15,30 和 45 秒，而 5/15 在分钟字段中表示 5,20,35,50，你也可以使用<em>/y，它等同于 0/y；<br>●L：该字符只在日期和星期字段中使用，代表“Last”的意思，但它在两个字段中意思不同。L 在日期<br>字段中，表示这个月份的最后一天，如一月的 31 号，非闰年二月的 28 号；如果 L 用在星期中，则表示星<br>期六，等同于 7。但是，如果 L 出现在星期字段里，而且在前面有一个数值 X，则表示“这个月的最后 X 天”，<br>例如，6L 表示该月的最后星期五；<br>●W：该字符只能出现在日期字段里，是对前导日期的修饰，表示离该日期最近的工作日。例如 15W<br>表示离该月 15 号最近的工作日，如果该月 15 号是星期六，则匹配 14 号星期五；如果 15 日是星期日，<br>则匹配 16 号星期一；如果 15 号是星期二，那结果就是 15 号星期二。但必须注意关联的匹配日期不能够<br>跨月，如你指定 1W，如果 1 号是星期六，结果匹配的是 3 号星期一，而非上个月最后的那天。W 字符串<br>只能指定单一日期，而不能指定日期范围；<br>●LW 组合：在日期字段可以组合使用 LW，它的意思是当月的最后一个工作日；<br>●井号(#)：该字符只能在星期字段中使用，表示当月某个工作日。如 6#3 表示当月的第三个星期五(6<br>表示星期五，#3 表示当前的第三个)，而 4#5 表示当月的第五个星期三，假设当月没有第五个星期三，<br>忽略不触发；<br>● C：该字符只在日期和星期字段中使用，代表“Calendar”的意思。它的意思是计划所关联的日期，<br>如果日期没有被关联，则相当于日历中所有日期。例如 5C 在日期字段中就相当于日历 5 日以后的第一天。<br>1C 在星期字段中相当于星期日后的第一天。<br>Cron 表达式对特殊字符的大小写不敏感，对代表星期的缩写英文大小写也不敏感。<br>例子:<br>@Scheduled(cron = “0 0 1 1 1 ?”) 每年一月的一号的 1:00:00 执行一次<br>@Scheduled(cron = “0 0 1 1 1,6 ?”) 一月和六月的一号的 1:00:00 执行一次<br>@Scheduled(cron = “0 0 1 1 1,4,7,10 ?”) 每个季度的第一个月的一号的 1:00:00 执行一次<br>@Scheduled(cron = “0 0 1 1 </em> ?”) 每月一号 1:00:00 执行一次<br>@Scheduled(cron=”0 0 1 <em> </em> * “) 每天凌晨 1 点执行一次</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fankekeke.club/2019/01/08/SpringBoot定时任务/" data-id="cjrabl6q7001xvkdqqc8txjvf" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-SpringDataRedis" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/07/SpringDataRedis/" class="article-date">
  <time datetime="2019-01-07T00:17:25.000Z" itemprop="datePublished">2019-01-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/SpringData/">SpringData</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/07/SpringDataRedis/">SpringDataRedis</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="为什么需要SpringDataRedis"><a href="#为什么需要SpringDataRedis" class="headerlink" title="为什么需要SpringDataRedis"></a>为什么需要SpringDataRedis</h3><p>项目首页每天有大量的人访问，对数据库造成很大的访问压力，甚至是瘫痪。那如何解决呢？我们通常的做法有两种：一种是数据缓存、一种是网页静态化</p>
<h4 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h4><p><em>redis是一款开源的Key-Value数据库，运行在内存中，由ANSI C编写。企业开发通常采用Redis来实现缓存。同类的产品还有memcache 、memcached 、MongoDB等。</em></p>
<h4 id="Jedis"><a href="#Jedis" class="headerlink" title="Jedis"></a>Jedis</h4><p><em>Jedis是Redis官方推出的一款面向Java的客户端，提供了很多接口供Java语言调用。可以在Redis官网下载，当然还有一些开源爱好者提供的客户端，如Jredis、SRP等等，推荐使用Jedis。</em></p>
<h4 id="Spring-Data-Redis"><a href="#Spring-Data-Redis" class="headerlink" title="Spring Data Redis"></a>Spring Data Redis</h4><p>Spring-data-redis是spring大家族的一部分，提供了在srping应用中通过简单的配置访问redis服务，对reids底层开发包(Jedis, JRedis, and RJC)进行了高度封装，RedisTemplate提供了redis各种操作、异常处理及序列化，支持发布订阅，并对spring 3.1 cache进行了实现。<br>spring-data-redis针对jedis提供了如下功能：<br>1.连接池自动管理，提供了一个高度封装的“RedisTemplate”类<br>2.针对jedis客户端中大量api进行了归类封装,将同一类型操作封装为operation接口<br>ValueOperations：简单K-V操作<br>SetOperations：set类型数据操作<br>ZSetOperations：zset类型数据操作<br>HashOperations：针对map类型的数据操作<br>ListOperations：针对list类型的数据操作</p>
<h3 id="安装redis"><a href="#安装redis" class="headerlink" title="安装redis"></a>安装redis</h3><blockquote>
<p><a href="https://www.aliyun.com/jiaocheng/871740.html" target="_blank" rel="noopener">Windows系统下redis与可视化工具安装</a></p>
</blockquote>
<h3 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h3><h4 id="添加jar包"><a href="#添加jar包" class="headerlink" title="添加jar包"></a>添加jar包</h4><h4 id="创建applicationContext-xml"><a href="#创建applicationContext-xml" class="headerlink" title="创建applicationContext.xml"></a>创建applicationContext.xml</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">"http://www.springframework.org/schema/beans"</span></span><br><span class="line">       xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">       xmlns:context=<span class="string">"http://www.springframework.org/schema/context"</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">"http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">	http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">	http://www.springframework.org/schema/context</span></span><br><span class="line"><span class="string">	http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span><br><span class="line">    &lt;!-- 配置读取properties文件的工具类 --&gt;</span><br><span class="line">    &lt;context:property-placeholder location=<span class="string">"classpath:redis.properties"</span>/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- Jedis连接池 --&gt;</span><br><span class="line">    &lt;bean id=<span class="string">"poolConfig"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"redis.clients.jedis.JedisPoolConfig"</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">"maxTotal"</span> value=<span class="string">"$&#123;redis.pool.maxtTotal&#125;"</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">"maxIdle"</span> value=<span class="string">"$&#123;redis.pool.maxIdle&#125;"</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">"minIdle"</span> value=<span class="string">"$&#123;redis.pool.minIdle&#125;"</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- Jedis连接工厂:创建Jedis对象的工厂 --&gt;</span><br><span class="line">    &lt;bean id=<span class="string">"jedisConnectionFactory"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.data.redis.connection.jedis.JedisConnectionFactory"</span>&gt;</span><br><span class="line">        &lt;!-- IP地址 --&gt;</span><br><span class="line">        &lt;property name=<span class="string">"hostName"</span> value=<span class="string">"$&#123;redis.hostname&#125;"</span>/&gt;</span><br><span class="line">        &lt;!-- 端口 --&gt;</span><br><span class="line">        &lt;property name=<span class="string">"port"</span> value=<span class="string">"$&#123;redis.port&#125;"</span>/&gt;</span><br><span class="line">        &lt;!-- 密码 --&gt;</span><br><span class="line">        &lt;property name=<span class="string">"password"</span> value=<span class="string">"$&#123;redis.password&#125;"</span>/&gt;</span><br><span class="line">        &lt;!-- 连接池 --&gt;</span><br><span class="line">        &lt;property name=<span class="string">"poolConfig"</span> ref=<span class="string">"poolConfig"</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- Redis模板对象:是SpringDataRedis提供的用户操作Redis的对象 --&gt;</span><br><span class="line">    &lt;bean id=<span class="string">"redisTemplate"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.data.redis.core.RedisTemplate"</span>&gt;</span><br><span class="line">        &lt;!-- 默认的序列化器：序列化器就是根据规则将存储的数据中的key与value做字符串的序列化处理 --&gt;</span><br><span class="line">        &lt;!-- keySerializer、valueSerializer：对应的是Redis中的String类型 --&gt;</span><br><span class="line">        &lt;!-- hashKeySerializer、hashValueSerializer：对应的是Redis中的Hash类型 --&gt;</span><br><span class="line">        &lt;property name="connectionFactory" ref="jedisConnectionFactory"&gt;&lt;/property&gt;</span><br><span class="line">        &lt;property name=<span class="string">"keySerializer"</span>&gt;</span><br><span class="line">            &lt;bean class="org.springframework.data.redis.serializer.StringRedisSerializer"&gt;&lt;/bean&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property name=<span class="string">"valueSerializer"</span>&gt;</span><br><span class="line">            &lt;bean class="org.springframework.data.redis.serializer.StringRedisSerializer"&gt;&lt;/bean&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
<h4 id="创建redis-properties"><a href="#创建redis-properties" class="headerlink" title="创建redis.properties"></a>创建redis.properties</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">redis.pool.maxtTotal=20</span><br><span class="line">redis.pool.maxIdle=10</span><br><span class="line">redis.pool.minIdle=5</span><br><span class="line"></span><br><span class="line">redis.hostname=localhost</span><br><span class="line">redis.port=6379</span><br><span class="line">redis.password=123456</span><br></pre></td></tr></table></figure>
<h3 id="测试整合环境"><a href="#测试整合环境" class="headerlink" title="测试整合环境"></a>测试整合环境</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Redis 测试</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(<span class="string">"classpath:applicationContext.xml"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加键值对</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.redisTemplate.opsForValue().set(<span class="string">"lov"</span>, <span class="string">"利威尔阿克曼"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取 redis 中的数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String str =</span><br><span class="line">                (String)<span class="keyword">this</span>.redisTemplate.opsForValue().get(<span class="string">"lov"</span>);</span><br><span class="line">        System.out.println(str);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Spring-Data-Redisd存储实体对象"><a href="#Spring-Data-Redisd存储实体对象" class="headerlink" title="Spring Data Redisd存储实体对象"></a>Spring Data Redisd存储实体对象</h3><blockquote>
<p>测试代码</p>
</blockquote>
<p><strong>实体类必须实现Serializable接口<br>实体类必须实现Serializable接口<br>实体类必须实现Serializable接口</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 添加 Users</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span></span>&#123;</span><br><span class="line">Users users = <span class="keyword">new</span> Users();</span><br><span class="line">users.setAge(<span class="number">30</span>);</span><br><span class="line">users.setId(<span class="number">1</span>);</span><br><span class="line">users.setName(<span class="string">"张三"</span>);</span><br><span class="line"><span class="comment">//更换序列化器</span></span><br><span class="line"><span class="keyword">this</span>.redisTemplate.setValueSerializer(<span class="keyword">new</span></span><br><span class="line">JdkSerializationRedisSerializer());</span><br><span class="line"><span class="keyword">this</span>.redisTemplate.opsForValue().set(<span class="string">"users"</span>, users);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 获取 Users</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//更换序列化器</span></span><br><span class="line"><span class="keyword">this</span>.redisTemplate.setValueSerializer(<span class="keyword">new</span></span><br><span class="line">JdkSerializationRedisSerializer());</span><br><span class="line">Users users =</span><br><span class="line">(Users)<span class="keyword">this</span>.redisTemplate.opsForValue().get(<span class="string">"users"</span>);</span><br><span class="line">System.out.println(users);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="Spring-Data-Redis-以-JSON-的格式存储实体对象"><a href="#Spring-Data-Redis-以-JSON-的格式存储实体对象" class="headerlink" title="Spring Data Redis 以 JSON 的格式存储实体对象"></a>Spring Data Redis 以 JSON 的格式存储实体对象</h3><h4 id="导入jackson包"><a href="#导入jackson包" class="headerlink" title="导入jackson包"></a>导入jackson包</h4><h4 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 添加 Users JSON 格式</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test5</span><span class="params">()</span></span>&#123;</span><br><span class="line">Users users = <span class="keyword">new</span> Users();</span><br><span class="line">users.setAge(<span class="number">23</span>);</span><br><span class="line">users.setId(<span class="number">2</span>);</span><br><span class="line">users.setName(<span class="string">"李四"</span>);</span><br><span class="line"><span class="keyword">this</span>.redisTemplate.setValueSerializer(<span class="keyword">new</span></span><br><span class="line">Jackson2JsonRedisSerializer&lt;&gt;(Users.class));</span><br><span class="line"><span class="keyword">this</span>.redisTemplate.opsForValue().set(<span class="string">"usersjson"</span>, users);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 获取 Uesrs JSON 格式</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test6</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">this</span>.redisTemplate.setValueSerializer(<span class="keyword">new</span></span><br><span class="line">Jackson2JsonRedisSerializer&lt;&gt;(Users.class));</span><br><span class="line">Users users =</span><br><span class="line">(Users)<span class="keyword">this</span>.redisTemplate.opsForValue().get(<span class="string">"usersjson"</span>);</span><br><span class="line">System.out.println(users);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://fankekeke.club/2019/01/07/SpringDataRedis/" data-id="cjrabl6qz002svkdqr4kanr49" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Spring-Data-JPA关联映射操作" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/04/Spring-Data-JPA关联映射操作/" class="article-date">
  <time datetime="2019-01-04T06:45:14.000Z" itemprop="datePublished">2019-01-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/SpringData/">SpringData</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/04/Spring-Data-JPA关联映射操作/">Spring_Data_JPA关联映射操作</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<h4 id="一对一的关联关系"><a href="#一对一的关联关系" class="headerlink" title="一对一的关联关系"></a>一对一的关联关系</h4></blockquote>
<p><em>需求：用户与角色的一对一的关联关系<br>用户：一方<br>角色：一方</em></p>
<blockquote>
<h5 id="创建Users实体类"><a href="#创建Users实体类" class="headerlink" title="创建Users实体类"></a>创建Users实体类</h5></blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"users"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Users</span> </span>&#123;</span><br><span class="line">    <span class="comment">//    主键自增策略，自增</span></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"id"</span>)</span><br><span class="line">    <span class="keyword">private</span> Integer userId;</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"username"</span>)</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"password"</span>)</span><br><span class="line">    <span class="keyword">private</span> String passWord;</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"email"</span>)</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="meta">@OneToOne</span>(cascade = CascadeType.PERSIST)</span><br><span class="line">    <span class="comment">//@JoinColumn：就是维护一个外键</span></span><br><span class="line">    <span class="meta">@JoinColumn</span>(name=<span class="string">"roles_id"</span>)</span><br><span class="line">    <span class="keyword">private</span> Roles roles;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Users</span><span class="params">(Integer userId, String userName, String passWord, String email)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userId = userId;</span><br><span class="line">        <span class="keyword">this</span>.userName = userName;</span><br><span class="line">        <span class="keyword">this</span>.passWord = passWord;</span><br><span class="line">        <span class="keyword">this</span>.email = email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Users</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Users&#123;"</span> +</span><br><span class="line">                <span class="string">"userId="</span> + userId +</span><br><span class="line">                <span class="string">", userName='"</span> + userName + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", passWord='"</span> + passWord + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", email='"</span> + email + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getUserId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserId</span><span class="params">(Integer userId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userId = userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserName</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userName = userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassWord</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> passWord;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassWord</span><span class="params">(String passWord)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.passWord = passWord;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getEmail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmail</span><span class="params">(String email)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.email = email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Roles <span class="title">getRoles</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> roles;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoles</span><span class="params">(Roles roles)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.roles = roles;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h5 id="创建Roles实体"><a href="#创建Roles实体" class="headerlink" title="创建Roles实体"></a>创建Roles实体</h5></blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name=<span class="string">"t_roles"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Roles</span> </span>&#123;</span><br><span class="line"><span class="meta">@Id</span></span><br><span class="line"><span class="meta">@GeneratedValue</span>(strategy=GenerationType.IDENTITY)</span><br><span class="line"><span class="meta">@Column</span>(name=<span class="string">"roleid"</span>)</span><br><span class="line"><span class="keyword">private</span> Integer roleid;</span><br><span class="line"><span class="meta">@Column</span>(name=<span class="string">"rolename"</span>)</span><br><span class="line"><span class="keyword">private</span> String rolename;</span><br><span class="line"><span class="meta">@OneToOne</span>(mappedBy=<span class="string">"roles"</span>)</span><br><span class="line"><span class="keyword">private</span> Users users;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Users <span class="title">getUsers</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> users;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsers</span><span class="params">(Users users)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.users = users;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Integer <span class="title">getRoleid</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> roleid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoleid</span><span class="params">(Integer roleid)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.roleid = roleid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getRolename</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> rolename;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRolename</span><span class="params">(String rolename)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.rolename = rolename;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="一对多的关联关系"><a href="#一对多的关联关系" class="headerlink" title="一对多的关联关系"></a>一对多的关联关系</h4></blockquote>
<p><em>需求：从角色到用户的一对多的关联关系<br>角色：一方<br>用户：多方</em></p>
<blockquote>
<h5 id="创建Users实体"><a href="#创建Users实体" class="headerlink" title="创建Users实体"></a>创建Users实体</h5></blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name=<span class="string">"t_users"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Users</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line"><span class="meta">@Id</span></span><br><span class="line"><span class="meta">@GeneratedValue</span>(strategy=GenerationType.IDENTITY)<span class="comment">//strategy=Gene</span></span><br><span class="line">rationType.IDENTITY 自增长</span><br><span class="line"><span class="meta">@Column</span>(name=<span class="string">"userid"</span>)</span><br><span class="line"><span class="keyword">private</span> Integer userid;</span><br><span class="line"><span class="meta">@Column</span>(name=<span class="string">"username"</span>)</span><br><span class="line"><span class="keyword">private</span> String username;</span><br><span class="line"><span class="meta">@Column</span>(name=<span class="string">"userage"</span>)</span><br><span class="line"><span class="keyword">private</span> Integer userage;</span><br><span class="line"><span class="meta">@ManyToOne</span>(cascade = CascadeType.PERSIST)</span><br><span class="line"><span class="meta">@JoinColumn</span>(name=<span class="string">"roles_id"</span>)</span><br><span class="line"><span class="keyword">private</span> Roles roles;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Integer <span class="title">getUserid</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> userid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserid</span><span class="params">(Integer userid)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.userid = userid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> username;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.username = username;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Integer <span class="title">getUserage</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> userage;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserage</span><span class="params">(Integer userage)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.userage = userage;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"Users [userid="</span> + userid + <span class="string">", username="</span> + username + <span class="string">",</span></span><br><span class="line"><span class="string">userage="</span> + userage + <span class="string">"]"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h5 id="创建Roles实体-1"><a href="#创建Roles实体-1" class="headerlink" title="创建Roles实体"></a>创建Roles实体</h5></blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"roles"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Roles1</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy= GenerationType.IDENTITY)</span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"roleid"</span>)</span><br><span class="line">    <span class="keyword">private</span> Integer roleid;</span><br><span class="line">    <span class="meta">@Column</span>(name=<span class="string">"roleName"</span>)</span><br><span class="line">    <span class="keyword">private</span> String rolename;</span><br><span class="line">    <span class="meta">@OneToMany</span>(mappedBy=<span class="string">"roles"</span>)</span><br><span class="line">    <span class="keyword">private</span> Set&lt;Users&gt; users = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getRoleid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> roleid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoleid</span><span class="params">(Integer roleid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.roleid = roleid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getRolename</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> rolename;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRolename</span><span class="params">(String rolename)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.rolename = rolename;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Roles [roleid="</span> + roleid + <span class="string">", rolename="</span> + rolename + <span class="string">"]"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;Users&gt; <span class="title">getUsers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> users;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsers</span><span class="params">(Set&lt;Users&gt; users)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.users = users;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h5 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h5></blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 一对多的关联关系测试</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(<span class="string">"classpath:applicationContext.xml"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OneToManyTest</span> </span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UsersDao usersDao;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 添加用户同时添加角色</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//创建角色</span></span><br><span class="line">Roles roles = <span class="keyword">new</span> Roles();</span><br><span class="line">roles.setRolename(<span class="string">"管理员"</span>);</span><br><span class="line"><span class="comment">//创建用户</span></span><br><span class="line">Users users =<span class="keyword">new</span> Users();</span><br><span class="line">users.setUserage(<span class="number">30</span>);</span><br><span class="line">users.setUsername(<span class="string">"小王"</span>);</span><br><span class="line"><span class="comment">//建立关系</span></span><br><span class="line">roles.getUsers().add(users);</span><br><span class="line">users.setRoles(roles);</span><br><span class="line"><span class="comment">//保存数据</span></span><br><span class="line"><span class="keyword">this</span>.usersDao.save(users);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 根据用户 ID 查询用户信息，同时查询角色</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span></span>&#123;</span><br><span class="line">Users users = <span class="keyword">this</span>.usersDao.findOne(<span class="number">14</span>);</span><br><span class="line">System.out.println(<span class="string">"用户姓名："</span>+users.getUsername());</span><br><span class="line">Roles roles = users.getRoles();</span><br><span class="line">System.out.println(roles);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h4 id="多对多的关联关系"><a href="#多对多的关联关系" class="headerlink" title="多对多的关联关系"></a>多对多的关联关系</h4></blockquote>
<p><em>需求：一个角色可以拥有多个菜单，一个菜单可以分配多个角色。多对多的关联关系<br>角色：多方<br>菜单：多方</em></p>
<blockquote>
<h5 id="创建Roles实体-2"><a href="#创建Roles实体-2" class="headerlink" title="创建Roles实体"></a>创建Roles实体</h5></blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name=<span class="string">"t_roles"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Roles</span> </span>&#123;</span><br><span class="line"><span class="meta">@Id</span></span><br><span class="line"><span class="meta">@GeneratedValue</span>(strategy=GenerationType.IDENTITY)</span><br><span class="line"><span class="meta">@Column</span>(name=<span class="string">"roleid"</span>)</span><br><span class="line"><span class="keyword">private</span> Integer roleid;</span><br><span class="line"><span class="meta">@Column</span>(name=<span class="string">"rolename"</span>)</span><br><span class="line"><span class="keyword">private</span> String rolename;</span><br><span class="line"><span class="meta">@ManyToMany</span></span><br><span class="line"><span class="comment">//@JoinTable:配置中间表信息</span></span><br><span class="line"><span class="comment">//joinColumns:建立当前表在中间表中的外键字段</span></span><br><span class="line"><span class="meta">@JoinTable</span>(name=<span class="string">"t_roles_menus"</span>,joinColumns=<span class="meta">@JoinColumn</span>(name=<span class="string">"ro</span></span><br><span class="line"><span class="string">le_id"</span>),inverseJoinColumns=<span class="meta">@JoinColumn</span>(name=<span class="string">"menu_id"</span>))</span><br><span class="line"><span class="keyword">private</span> Set&lt;Menus&gt; menus = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line"><span class="function"><span class="keyword">public</span> Set&lt;Menus&gt; <span class="title">getMenus</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> menus;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMenus</span><span class="params">(Set&lt;Menus&gt; menus)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.menus = menus;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Integer <span class="title">getRoleid</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> roleid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoleid</span><span class="params">(Integer roleid)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.roleid = roleid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getRolename</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> rolename;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRolename</span><span class="params">(String rolename)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.rolename = rolename;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"Roles [roleid="</span> + roleid + <span class="string">", rolename="</span> + rolename + <span class="string">"]"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h5 id="创建Menus实体"><a href="#创建Menus实体" class="headerlink" title="创建Menus实体"></a>创建Menus实体</h5></blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name=<span class="string">"t_menus"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Menus</span> </span>&#123;</span><br><span class="line"><span class="meta">@Id</span></span><br><span class="line"><span class="meta">@GeneratedValue</span>(strategy=GenerationType.IDENTITY)</span><br><span class="line"><span class="meta">@Column</span>(name=<span class="string">"menusid"</span>)</span><br><span class="line"><span class="keyword">private</span> Integer menusid;</span><br><span class="line"><span class="meta">@Column</span>(name=<span class="string">"menusname"</span>)</span><br><span class="line"><span class="keyword">private</span> String menusname;</span><br><span class="line"><span class="meta">@Column</span>(name=<span class="string">"menusurl"</span>)</span><br><span class="line"><span class="keyword">private</span> String menusurl;</span><br><span class="line"><span class="meta">@Column</span>(name=<span class="string">"fatherid"</span>)</span><br><span class="line"><span class="keyword">private</span> Integer fatherid;</span><br><span class="line"><span class="meta">@ManyToMany</span>(mappedBy=<span class="string">"menus"</span>)</span><br><span class="line"><span class="keyword">private</span> Set&lt;Roles&gt; roles = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line"><span class="function"><span class="keyword">public</span> Set&lt;Roles&gt; <span class="title">getRoles</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> roles;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoles</span><span class="params">(Set&lt;Roles&gt; roles)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.roles = roles;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Integer <span class="title">getMenusid</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> menusid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMenusid</span><span class="params">(Integer menusid)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.menusid = menusid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getMenusname</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> menusname;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMenusname</span><span class="params">(String menusname)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.menusname = menusname;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getMenusurl</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> menusurl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMenusurl</span><span class="params">(String menusurl)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.menusurl = menusurl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Integer <span class="title">getFatherid</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> fatherid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFatherid</span><span class="params">(Integer fatherid)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.fatherid = fatherid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"Menus [menusid="</span> + menusid + <span class="string">", menusname="</span> + menusname</span><br><span class="line">+ <span class="string">", menusurl="</span> + menusurl + <span class="string">", fatherid="</span></span><br><span class="line">+ fatherid + <span class="string">"]"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h5 id="多对多关联关系操作"><a href="#多对多关联关系操作" class="headerlink" title="多对多关联关系操作"></a>多对多关联关系操作</h5></blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 多对多关联关系测试</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(<span class="string">"classpath:applicationContext.xml"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ManyToManyTest</span> </span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RolesDao rolesDao;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 添加角色同时添加菜单</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//创建角色对象</span></span><br><span class="line">Roles roles = <span class="keyword">new</span> Roles();</span><br><span class="line">roles.setRolename(<span class="string">"超级管理员"</span>);</span><br><span class="line"><span class="comment">//创建菜单对象 XXX 管理平台 ---&gt;用户管理</span></span><br><span class="line">Menus menus = <span class="keyword">new</span> Menus();</span><br><span class="line">menus.setMenusname(<span class="string">"XXX 管理平台"</span>);</span><br><span class="line">menus.setFatherid(-<span class="number">1</span>);</span><br><span class="line">menus.setMenusurl(<span class="keyword">null</span>);</span><br><span class="line"><span class="comment">//用户管理菜单</span></span><br><span class="line">Menus menus1 = <span class="keyword">new</span> Menus();</span><br><span class="line">menus1.setMenusname(<span class="string">"用户管理"</span>);</span><br><span class="line">menus1.setFatherid(<span class="number">1</span>);</span><br><span class="line">menus1.setMenusurl(<span class="keyword">null</span>);</span><br><span class="line"><span class="comment">//建立关系</span></span><br><span class="line">roles.getMenus().add(menus);</span><br><span class="line">roles.getMenus().add(menus1);</span><br><span class="line">menus.getRoles().add(roles);</span><br><span class="line">menus1.getRoles().add(roles);</span><br><span class="line"><span class="comment">//保存数据</span></span><br><span class="line"><span class="keyword">this</span>.rolesDao.save(roles);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 查询 Roles</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span></span>&#123;</span><br><span class="line">Roles roles = <span class="keyword">this</span>.rolesDao.findOne(<span class="number">3</span>);</span><br><span class="line">System.out.println(<span class="string">"角色信息："</span>+roles);</span><br><span class="line">Set&lt;Menus&gt; menus = roles.getMenus();</span><br><span class="line"><span class="keyword">for</span> (Menus menus2 : menus) &#123;</span><br><span class="line">System.out.println(<span class="string">"菜单信息："</span>+menus2);</span><br><span class="line">&#125; &#125; &#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fankekeke.club/2019/01/04/Spring-Data-JPA关联映射操作/" data-id="cjrabl6qa001yvkdqrxhrik59" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-SpringData-JPA" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/03/SpringData-JPA/" class="article-date">
  <time datetime="2019-01-03T04:12:59.000Z" itemprop="datePublished">2019-01-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/SpringData/">SpringData</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/03/SpringData-JPA/">SpringData_JPA</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>Spring Data JAP:</strong><br>Spring Data JAP是 spring data 项目下的一个模块。提供了一套基于 JPA标准操作数据库的简化方案。底层默认的是依赖 Hibernate JPA 来实现的。</p>
<p><strong>Spring Data JPA 的技术特点</strong>：<br>我们只需要定义接口并集成 Spring Data JPA 中所提供的接口就可以了。不需要编写接口实现类</p>
<h4 id="创建-Spring-Data-JPA-项目"><a href="#创建-Spring-Data-JPA-项目" class="headerlink" title="创建 Spring Data JPA 项目"></a>创建 Spring Data JPA 项目</h4><h5 id="1-导入-jar-包"><a href="#1-导入-jar-包" class="headerlink" title="1 导入 jar 包"></a>1 导入 jar 包</h5><h5 id="2-修改配置文件"><a href="#2-修改配置文件" class="headerlink" title="2 修改配置文件"></a>2 修改配置文件</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">"http://www.springframework.org/schema/beans"</span></span><br><span class="line">       xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">       xmlns:context=<span class="string">"http://www.springframework.org/schema/context"</span></span><br><span class="line">       xmlns:aop=<span class="string">"http://www.springframework.org/schema/aop"</span></span><br><span class="line">       xmlns:tx=<span class="string">"http://www.springframework.org/schema/tx"</span></span><br><span class="line">       xmlns:jpa=<span class="string">"http://www.springframework.org/schema/data/jpa"</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">"http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/context</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/context/spring-context.xsd</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/aop</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/aop/spring-aop.xsd</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/data/jpa</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/data/jpa/spring-jpa.xsd</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/tx</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/tx/spring-tx.xsd"</span>&gt;</span><br><span class="line">    &lt;!-- 配置读取 properties 文件的工具类 --&gt;</span><br><span class="line">    &lt;context:property-placeholder</span><br><span class="line">            location=<span class="string">"classpath:jdbc.properties"</span>/&gt;</span><br><span class="line">    &lt;!-- 配置 c3p0 数据库连接池 --&gt;</span><br><span class="line">    &lt;bean id=<span class="string">"dataSource"</span></span><br><span class="line">          <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">"jdbcUrl"</span> value=<span class="string">"$&#123;jdbc.url&#125;"</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">"driverClass"</span> value=<span class="string">"$&#123;jdbc.driver.class&#125;"</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">"user"</span> value=<span class="string">"$&#123;jdbc.username&#125;"</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">"password"</span> value=<span class="string">"$&#123;jdbc.password&#125;"</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;!-- Spring 整合 JPA 配置 EntityManagerFactory--&gt;</span><br><span class="line">    &lt;bean id=<span class="string">"entityManagerFactory"</span></span><br><span class="line">          <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">"dataSource"</span> ref=<span class="string">"dataSource"</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">"jpaVendorAdapter"</span>&gt;</span><br><span class="line">            &lt;bean</span><br><span class="line">                    <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter"</span>&gt;</span><br><span class="line">                &lt;!-- hibernate 相关的属性的注入 --&gt;</span><br><span class="line">                &lt;!-- 配置数据库类型 --&gt;</span><br><span class="line">                &lt;property name=<span class="string">"database"</span> value=<span class="string">"MYSQL"</span>/&gt;</span><br><span class="line">                &lt;!-- 正向工程 自动创建表 --&gt;</span><br><span class="line">                &lt;property name=<span class="string">"generateDdl"</span> value=<span class="string">"true"</span>/&gt;</span><br><span class="line">                &lt;!-- 显示执行的 SQL --&gt;</span><br><span class="line">                &lt;property name=<span class="string">"showSql"</span> value=<span class="string">"true"</span>/&gt;</span><br><span class="line">            &lt;/bean&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;!-- 扫描实体的包 --&gt;</span><br><span class="line">        &lt;property name=<span class="string">"packagesToScan"</span>&gt;</span><br><span class="line">            &lt;list&gt;</span><br><span class="line">                &lt;value&gt;com.fanke.pojo&lt;/value&gt;</span><br><span class="line">            &lt;/list&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;!-- 配置 Hibernate 的事务管理器 --&gt;</span><br><span class="line">    &lt;bean id=<span class="string">"transactionManager"</span></span><br><span class="line">          <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.orm.jpa.JpaTransactionManager"</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">"entityManagerFactory"</span></span><br><span class="line">                  ref=<span class="string">"entityManagerFactory"</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;!-- 配置开启注解事务处理 --&gt;</span><br><span class="line">    &lt;tx:annotation-driven transaction-manager=<span class="string">"transactionManager"</span>/&gt;</span><br><span class="line">    &lt;!-- 配置 springIOC 的注解扫描 --&gt;</span><br><span class="line">    &lt;context:component-scan base-<span class="keyword">package</span>=<span class="string">"com.fanke"</span>/&gt;</span><br><span class="line">    &lt;!-- Spring Data JPA 的配置 --&gt;</span><br><span class="line">    &lt;!-- base-<span class="keyword">package</span>：扫描 dao 接口所在的包 --&gt;</span><br><span class="line">    &lt;jpa:repositories base-<span class="keyword">package</span>=<span class="string">"com.fanke.dao"</span>/&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
<h5 id="3-编写-Dao"><a href="#3-编写-Dao" class="headerlink" title="3 编写 Dao"></a>3 编写 Dao</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UsersDao</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Users</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(<span class="string">"classpath:applicationContext.xml"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UsersDaoImplTest</span> </span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UsersDao usersDao;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 添加用户</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@Transactional</span><span class="comment">// 在测试类对于事务提交方式默认的是回滚。</span></span><br><span class="line"><span class="meta">@Rollback</span>(<span class="keyword">false</span>)<span class="comment">//取消自动回滚</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInsertUsers</span><span class="params">()</span></span>&#123;</span><br><span class="line">Users users = <span class="keyword">new</span> Users();</span><br><span class="line">users.setUserage(<span class="number">24</span>);</span><br><span class="line">users.setUsername(<span class="string">"张三"</span>);</span><br><span class="line"><span class="keyword">this</span>.usersDao.save(users);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Spring-Data-JAP的接口继承结构"><a href="#Spring-Data-JAP的接口继承结构" class="headerlink" title="Spring Data JAP的接口继承结构"></a>Spring Data JAP的接口继承结构</h4><p><img src="https://img-blog.csdn.net/20170305233135884?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc3VuaHVpbGlhbmc4NQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>
<h4 id="Repository-接口"><a href="#Repository-接口" class="headerlink" title="Repository 接口"></a>Repository 接口</h4><p><em>Repository 接口是 Spring Data JPA 中为我我们提供的所有接口中的顶层接口</em><br>Repository 提供了两种查询方式的支持<br>1）基于方法名称命名规则查询<br>2）基于@Query 注解查询</p>
<h5 id="方法名称命名规则查询"><a href="#方法名称命名规则查询" class="headerlink" title="方法名称命名规则查询"></a>方法名称命名规则查询</h5><p><em>findBy(关键字)+属性名称(属性名称的首字母大写)+查询条件(首字母大写)</em></p>
<table>
<thead>
<tr>
<th style="text-align:center">关键字</th>
<th style="text-align:center">方法命名</th>
<th style="text-align:center">sql where 字句</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">And</td>
<td style="text-align:center">findByNameAndPwd</td>
<td style="text-align:center">where name= ? and pwd =?</td>
</tr>
<tr>
<td style="text-align:center">Or</td>
<td style="text-align:center">findByNameOrSex</td>
<td style="text-align:center">where name= ? or sex=?</td>
</tr>
<tr>
<td style="text-align:center">Is,Equal</td>
<td style="text-align:center">findById,findByIdEquals</td>
<td style="text-align:center">where id= ?</td>
</tr>
<tr>
<td style="text-align:center">Between</td>
<td style="text-align:center">findByIdBetween</td>
<td style="text-align:center">where id between ?and ?</td>
</tr>
<tr>
<td style="text-align:center">LessThan</td>
<td style="text-align:center">findByIdLessThan</td>
<td style="text-align:center">where id &lt; ?</td>
</tr>
<tr>
<td style="text-align:center">LessThanEqual</td>
<td style="text-align:center">findByIdLessThanEquals</td>
<td style="text-align:center">where id &lt;= ?</td>
</tr>
<tr>
<td style="text-align:center">GreaterThan</td>
<td style="text-align:center">findByIdGreaterThan</td>
<td style="text-align:center">where id &gt; ?</td>
</tr>
<tr>
<td style="text-align:center">GreaterThanEqual</td>
<td style="text-align:center">findByIdGreaterThanEquals</td>
<td style="text-align:center">where id &gt; = ?</td>
</tr>
<tr>
<td style="text-align:center">After</td>
<td style="text-align:center">findByIdAfter</td>
<td style="text-align:center">where id &gt; ?</td>
</tr>
<tr>
<td style="text-align:center">Before</td>
<td style="text-align:center">findByIdBefore</td>
<td style="text-align:center">where id &lt; ?</td>
</tr>
<tr>
<td style="text-align:center">IsNull</td>
<td style="text-align:center">findByNameIsNull</td>
<td style="text-align:center">where name is null</td>
</tr>
<tr>
<td style="text-align:center">isNotNull,Not</td>
<td style="text-align:center">findByNameNotNull</td>
<td style="text-align:center">where name is not</td>
</tr>
<tr>
<td style="text-align:center">Like</td>
<td style="text-align:center">findByNameLike</td>
<td style="text-align:center">where name like ?</td>
</tr>
<tr>
<td style="text-align:center">NotLike</td>
<td style="text-align:center">findByNameNotLike</td>
<td style="text-align:center">where name not like ?</td>
</tr>
<tr>
<td style="text-align:center">StartingWith</td>
<td style="text-align:center">findByNameStartingWith</td>
<td style="text-align:center">where name like ‘?%’</td>
</tr>
<tr>
<td style="text-align:center">EndingWith</td>
<td style="text-align:center">findByNameEndingWith</td>
<td style="text-align:center">where name like ‘%?’</td>
</tr>
<tr>
<td style="text-align:center">Containing</td>
<td style="text-align:center">findByNameContaining</td>
<td style="text-align:center">where name like’%?%’</td>
</tr>
<tr>
<td style="text-align:center">OrderBy</td>
<td style="text-align:center">findByIdOrderByXDesc</td>
<td style="text-align:center">where id=? order byx desc</td>
</tr>
<tr>
<td style="text-align:center">Not</td>
<td style="text-align:center">findByNameNot</td>
<td style="text-align:center">where name &lt;&gt; ?</td>
</tr>
<tr>
<td style="text-align:center">In</td>
<td style="text-align:center">findByIdIn(Collection&lt;?&gt; c)</td>
<td style="text-align:center">where id in (?)</td>
</tr>
<tr>
<td style="text-align:center">NotIn</td>
<td style="text-align:center">findByIdNotIn(Collection&lt;?&gt; c)</td>
<td style="text-align:center">where id not in(?)</td>
</tr>
<tr>
<td style="text-align:center">True</td>
<td style="text-align:center">findByAaaTue</td>
<td style="text-align:center">where aaa = true</td>
</tr>
<tr>
<td style="text-align:center">False</td>
<td style="text-align:center">findByAaaFalse</td>
<td style="text-align:center">where aaa = false</td>
</tr>
<tr>
<td style="text-align:center">IgnoreCase</td>
<td style="text-align:center">findByNameIgnoreCase</td>
<td style="text-align:center">whereUPPER(name)=UPPER(?)</td>
</tr>
</tbody>
</table>
<h5 id="Repository-接口-1"><a href="#Repository-接口-1" class="headerlink" title="Repository 接口"></a>Repository 接口</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UsersDao1</span> <span class="keyword">extends</span> <span class="title">Repository</span>&lt;<span class="title">Users</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">List&lt;Users&gt; <span class="title">findByEmailIs</span><span class="params">(String string)</span></span>;</span><br><span class="line">    <span class="function">List&lt;Users&gt; <span class="title">findByUserNameLike</span><span class="params">(String string)</span></span>;</span><br><span class="line"><span class="comment">//    List&lt;Users&gt; findByUsernameAndUserageGreaterThanEqual(String name,Integer age);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="测试方法"><a href="#测试方法" class="headerlink" title="测试方法"></a>测试方法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Repository 接口测试</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(<span class="string">"classpath:applicationContext.xml"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RepositoryTest</span> </span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UsersDao usersDao;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 需求：使用用户名作为查询条件</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 判断相等的条件，有三种表示方式</span></span><br><span class="line"><span class="comment">* 1,什么都不写，默认的就是做相等判断</span></span><br><span class="line"><span class="comment">* 2,Is</span></span><br><span class="line"><span class="comment">* 3,Equal</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">List&lt;Users&gt; list = <span class="keyword">this</span>.usersDao.findByUsernameIs(<span class="string">"王五"</span>);</span><br><span class="line"><span class="keyword">for</span> (Users users : list) &#123;</span><br><span class="line">System.out.println(users);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 需求：根据用户姓名做 Like 处理</span></span><br><span class="line"><span class="comment">* Like:条件关键字</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span></span>&#123;</span><br><span class="line">List&lt;Users&gt; list = <span class="keyword">this</span>.usersDao.findByUsernameLike(<span class="string">"王%"</span>);</span><br><span class="line"><span class="keyword">for</span> (Users users : list) &#123;</span><br><span class="line">System.out.println(users);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 需求：查询名称为王五，并且他的年龄大于等于 22 岁</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span></span>&#123;</span><br><span class="line">List&lt;Users&gt; list =</span><br><span class="line"><span class="keyword">this</span>.usersDao.findByUsernameAndUserageGreaterThanEqual(<span class="string">"王五"</span>, <span class="number">22</span>);</span><br><span class="line"><span class="keyword">for</span> (Users users : list) &#123;</span><br><span class="line">System.out.println(users);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="基于-Query-注解的查询"><a href="#基于-Query-注解的查询" class="headerlink" title="基于@Query 注解的查询"></a>基于@Query 注解的查询</h4><h5 id="通过-JPQL-语句查询"><a href="#通过-JPQL-语句查询" class="headerlink" title="通过 JPQL 语句查询"></a>通过 JPQL 语句查询</h5><blockquote>
<p>JPQL：通过 Hibernate 的 HQL 演变过来的。他和 HQL 语法及其相似。</p>
</blockquote>
<h6 id="创建接口"><a href="#创建接口" class="headerlink" title="创建接口"></a><strong>创建接口</strong></h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UsersDao2</span> <span class="keyword">extends</span> <span class="title">Repository</span>&lt;<span class="title">Users</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">//使用@Query 注解查询</span></span><br><span class="line">    <span class="meta">@Query</span>(value=<span class="string">"from Users where userName = ?"</span>)</span><br><span class="line">    <span class="function">List&lt;Users&gt; <span class="title">queryUserByNameUseJPQL</span><span class="params">(String name)</span></span>;</span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"from Users where userName like ?"</span>)</span><br><span class="line">    <span class="function">List&lt;Users&gt; <span class="title">queryUserByLikeNameUseJPQL</span><span class="params">(String name)</span></span>;</span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"from Users where userName = ? and passWord &gt;= ?"</span>)</span><br><span class="line">    <span class="function">List&lt;Users&gt; <span class="title">queryUserByNameAndAge</span><span class="params">(String name,String password)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h6 id="测试方法-1"><a href="#测试方法-1" class="headerlink" title="测试方法"></a><strong>测试方法</strong></h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试<span class="doctag">@Query</span> 查询 JPQL</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span></span>&#123;</span><br><span class="line">        List&lt;Users&gt; list = <span class="keyword">this</span>.usersDao2.queryUserByNameUseJPQL(<span class="string">"史迪仔"</span>);</span><br><span class="line">        <span class="keyword">for</span> (Users users : list) &#123;</span><br><span class="line">            System.out.println(users);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试<span class="doctag">@Query</span> 查询 JPQL</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test5</span><span class="params">()</span></span>&#123;</span><br><span class="line">        List&lt;Users&gt; list = <span class="keyword">this</span>.usersDao2.queryUserByLikeNameUseJPQL(<span class="string">" 王%"</span>);</span><br><span class="line">        <span class="keyword">for</span> (Users users : list) &#123;</span><br><span class="line">            System.out.println(users);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试<span class="doctag">@Query</span> 查询 JPQL</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test6</span><span class="params">()</span></span>&#123;</span><br><span class="line">        List&lt;Users&gt; list = <span class="keyword">this</span>.usersDao2.queryUserByNameAndAge(<span class="string">"杜登狗"</span>,<span class="string">"123456"</span>);</span><br><span class="line">        <span class="keyword">for</span> (Users users : list) &#123;</span><br><span class="line">            System.out.println(users);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h5 id="通过-SQL-语句查询"><a href="#通过-SQL-语句查询" class="headerlink" title="通过 SQL 语句查询"></a>通过 SQL 语句查询</h5><h6 id="创建接口-1"><a href="#创建接口-1" class="headerlink" title="创建接口"></a>创建接口</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UsersDao3</span> <span class="keyword">extends</span> <span class="title">Repository</span>&lt;<span class="title">Users</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">//使用@Query 注解查询 SQL</span></span><br><span class="line">    <span class="comment">//nativeQuery:默认的是 false.表示不开启 sql 查询。是否对 value 中的语句做转义。</span></span><br><span class="line">    <span class="meta">@Query</span>(value=<span class="string">"select * from users where username = ?"</span>,nativeQuery=<span class="keyword">true</span>)</span><br><span class="line">    <span class="function">List&lt;Users&gt; <span class="title">queryUserByNameUseSQL</span><span class="params">(String name)</span></span>;</span><br><span class="line">    <span class="meta">@Query</span>(value=<span class="string">"select * from users where username like ?"</span>,nativeQuery=<span class="keyword">true</span>)</span><br><span class="line">    <span class="function">List&lt;Users&gt; <span class="title">queryUserByLikeNameUseSQL</span><span class="params">(String name)</span></span>;</span><br><span class="line">    <span class="meta">@Query</span>(value=<span class="string">"select * from users where username = ? and password &gt;= ?"</span>,nativeQuery=<span class="keyword">true</span>)</span><br><span class="line">    <span class="function">List&lt;Users&gt; <span class="title">queryUserByNameAndAgeUseSQL</span><span class="params">(String name,String password)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="测试方法-2"><a href="#测试方法-2" class="headerlink" title="测试方法"></a>测试方法</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试<span class="doctag">@Query</span> 查询 SQL</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test7</span><span class="params">()</span></span>&#123;</span><br><span class="line">        List&lt;Users&gt; list = <span class="keyword">this</span>.usersDao3.queryUserByNameUseSQL(<span class="string">"杜登狗"</span>);</span><br><span class="line">        <span class="keyword">for</span> (Users users : list) &#123;</span><br><span class="line">            System.out.println(users);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试<span class="doctag">@Query</span> 查询 SQL</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test8</span><span class="params">()</span></span>&#123;</span><br><span class="line">        List&lt;Users&gt; list = <span class="keyword">this</span>.usersDao3.queryUserByLikeNameUseSQL(<span class="string">" 悲伤%"</span>);</span><br><span class="line">        <span class="keyword">for</span> (Users users : list) &#123;</span><br><span class="line">            System.out.println(users);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试<span class="doctag">@Query</span> 查询 SQL</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test9</span><span class="params">()</span></span>&#123;</span><br><span class="line">        List&lt;Users&gt; list = <span class="keyword">this</span>.usersDao3.queryUserByNameAndAgeUseSQL(<span class="string">" 杜登狗"</span>, <span class="string">"123456"</span>);</span><br><span class="line">        <span class="keyword">for</span> (Users users : list) &#123;</span><br><span class="line">            System.out.println(users);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="通过-Query-注解完成数据更新"><a href="#通过-Query-注解完成数据更新" class="headerlink" title="通过@Query 注解完成数据更新"></a>通过@Query 注解完成数据更新</h4><h5 id="创建接口-2"><a href="#创建接口-2" class="headerlink" title="创建接口"></a>创建接口</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Query</span>(<span class="string">"update Users set userage = ? where userid = ?"</span>)</span><br><span class="line"><span class="meta">@Modifying</span> <span class="comment">//@Modifying 当前语句是一个更新语句</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">updateUserAgeById</span><span class="params">(Integer age,Integer id)</span></span>;</span><br></pre></td></tr></table></figure>
<h5 id="测试类"><a href="#测试类" class="headerlink" title="测试类"></a>测试类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 测试<span class="doctag">@Query</span> update</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Rollback</span>(<span class="keyword">false</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test10</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">this</span>.usersDao.updateUserAgeById(<span class="number">24</span>, <span class="number">5</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="CrudRepository-接口"><a href="#CrudRepository-接口" class="headerlink" title="CrudRepository 接口"></a>CrudRepository 接口</h4><h5 id="创建接口-3"><a href="#创建接口-3" class="headerlink" title="创建接口"></a>创建接口</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* CrudRepository 接口讲解</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UsersDao</span> <span class="keyword">extends</span> <span class="title">CrudRepository</span>&lt;<span class="title">Users</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="测试方法-3"><a href="#测试方法-3" class="headerlink" title="测试方法"></a>测试方法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* CrudRepository 接口测试</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(<span class="string">"classpath:applicationContext.xml"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RepositoryTest</span> </span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UsersDao usersDao;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 添加单条数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">Users user = <span class="keyword">new</span> Users();</span><br><span class="line">user.setUserage(<span class="number">21</span>);</span><br><span class="line">user.setUsername(<span class="string">"赵小丽"</span>);</span><br><span class="line"><span class="keyword">this</span>.usersDao.save(user);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 批量添加数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span></span>&#123;</span><br><span class="line">Users user = <span class="keyword">new</span> Users();</span><br><span class="line">user.setUserage(<span class="number">21</span>);</span><br><span class="line">user.setUsername(<span class="string">"赵小丽"</span>);</span><br><span class="line">Users user1 = <span class="keyword">new</span> Users();</span><br><span class="line">user1.setUserage(<span class="number">25</span>);</span><br><span class="line">user1.setUsername(<span class="string">"王小虎"</span>);</span><br><span class="line">List&lt;Users&gt; list= <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">list.add(user);</span><br><span class="line">list.add(user1);</span><br><span class="line"><span class="keyword">this</span>.usersDao.save(list);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 根据 ID 查询单条数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span></span>&#123;</span><br><span class="line">Users users = <span class="keyword">this</span>.usersDao.findOne(<span class="number">13</span>);</span><br><span class="line">System.out.println(users);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 查询全部数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span></span>&#123;</span><br><span class="line">List&lt;Users&gt; list = (List&lt;Users&gt;)<span class="keyword">this</span>.usersDao.findAll();</span><br><span class="line"><span class="keyword">for</span> (Users users : list) &#123;</span><br><span class="line">System.out.println(users);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 删除数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test5</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">this</span>.usersDao.delete(<span class="number">13</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 更新数据 方式一</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test6</span><span class="params">()</span></span>&#123;</span><br><span class="line">Users user = <span class="keyword">this</span>.usersDao.findOne(<span class="number">12</span>);</span><br><span class="line">user.setUsername(<span class="string">"王小红"</span>);</span><br><span class="line"><span class="keyword">this</span>.usersDao.save(user);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 更新数据 方式二</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Rollback</span>(<span class="keyword">false</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test7</span><span class="params">()</span></span>&#123;</span><br><span class="line">Users user = <span class="keyword">this</span>.usersDao.findOne(<span class="number">12</span>);<span class="comment">//持久化状态的</span></span><br><span class="line">user.setUsername(<span class="string">"王小小"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="PagingAndSortingRepository-接口"><a href="#PagingAndSortingRepository-接口" class="headerlink" title="PagingAndSortingRepository 接口"></a>PagingAndSortingRepository 接口</h4><h5 id="分页处理"><a href="#分页处理" class="headerlink" title="分页处理"></a>分页处理</h5><p><strong>创建接口</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* PagingAndSortingRepository 接口讲解</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UsersDao</span> <span class="keyword">extends</span> <span class="title">PagingAndSortingRepository</span>&lt;<span class="title">Users</span>,</span></span><br><span class="line"><span class="class"><span class="title">Integer</span>&gt;</span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>测试方法</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* CrudRepository 接口测试</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(<span class="string">"classpath:applicationContext.xml"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RepositoryTest</span> </span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UsersDao usersDao;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 分页</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> page = <span class="number">2</span>; <span class="comment">//page:当前页的索引。注意索引都是从 0 开始的。</span></span><br><span class="line"><span class="keyword">int</span> size = <span class="number">3</span>;<span class="comment">// size:每页显示 3 条数据</span></span><br><span class="line">Pageable pageable= <span class="keyword">new</span> PageRequest(page, size);</span><br><span class="line">Page&lt;Users&gt; p = <span class="keyword">this</span>.usersDao.findAll(pageable);</span><br><span class="line">System.out.println(<span class="string">"数据的总条数："</span>+p.getTotalElements());</span><br><span class="line">System.out.println(<span class="string">"总页数："</span>+p.getTotalPages());</span><br><span class="line">List&lt;Users&gt; list = p.getContent();</span><br><span class="line"><span class="keyword">for</span> (Users users : list) &#123;</span><br><span class="line">System.out.println(users);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h5 id="排序的处理"><a href="#排序的处理" class="headerlink" title="排序的处理"></a>排序的处理</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 对单列做排序处理</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//Sort:该对象封装了排序规则以及指定的排序字段(对象的属性来表示)</span></span><br><span class="line"><span class="comment">//direction:排序规则</span></span><br><span class="line"><span class="comment">//properties:指定做排序的属性</span></span><br><span class="line">Sort sort = <span class="keyword">new</span> Sort(Direction.DESC,<span class="string">"userid"</span>);</span><br><span class="line">List&lt;Users&gt; list = (List&lt;Users&gt;)<span class="keyword">this</span>.usersDao.findAll(sort);</span><br><span class="line"><span class="keyword">for</span> (Users users : list) &#123;</span><br><span class="line">System.out.println(users);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 多列的排序处理</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//Sort:该对象封装了排序规则以及指定的排序字段(对象的属性来表示)</span></span><br><span class="line"><span class="comment">//direction:排序规则</span></span><br><span class="line"><span class="comment">//properties:指定做排序的属性</span></span><br><span class="line">Order order1 = <span class="keyword">new</span> Order(Direction.DESC,<span class="string">"userage"</span>);</span><br><span class="line">Order order2 = <span class="keyword">new</span> Order(Direction.ASC,<span class="string">"username"</span>);</span><br><span class="line">Sort sort = <span class="keyword">new</span> Sort(order1,order2);</span><br><span class="line">List&lt;Users&gt; list = (List&lt;Users&gt;)<span class="keyword">this</span>.usersDao.findAll(sort);</span><br><span class="line"><span class="keyword">for</span> (Users users : list) &#123;</span><br><span class="line">System.out.println(users);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="JpaRepository-接口"><a href="#JpaRepository-接口" class="headerlink" title="JpaRepository 接口"></a>JpaRepository 接口</h4><blockquote>
<p><em>JpaRepository 接口是我们开发时使用的最多的接口。其特点是可以帮助我们将其他接口<br>的方法的返回值做适配处理。可以使得我们在开发时更方便的使用这些方法。</em></p>
</blockquote>
<h5 id="创建接口-4"><a href="#创建接口-4" class="headerlink" title="创建接口"></a>创建接口</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* JpaRepository 接口讲解</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UsersDao</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Users</span>, <span class="title">Integer</span>&gt;</span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="测试方法-4"><a href="#测试方法-4" class="headerlink" title="测试方法"></a>测试方法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* JpaRepository 接口测试</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(<span class="string">"classpath:applicationContext.xml"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RepositoryTest</span> </span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UsersDao usersDao;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 查询全部数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">List&lt;Users&gt; list = <span class="keyword">this</span>.usersDao.findAll();</span><br><span class="line"><span class="keyword">for</span> (Users users : list) &#123;</span><br><span class="line">System.out.println(users);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="JpaSpecificationExecutor-接口"><a href="#JpaSpecificationExecutor-接口" class="headerlink" title="JpaSpecificationExecutor 接口"></a>JpaSpecificationExecutor 接口</h4><blockquote>
<p><em>完成多条件查询，并且支持分页与排序</em></p>
</blockquote>
<h5 id="单条件查询"><a href="#单条件查询" class="headerlink" title="单条件查询"></a>单条件查询</h5><h6 id="创建接口-5"><a href="#创建接口-5" class="headerlink" title="创建接口"></a>创建接口</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* JpaSpecificationExecutor 接口讲解</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment">*注意：JpaSpecificationExecutor&lt;Users&gt;:不能单独使用，需要配合着 jpa 中的</span></span><br><span class="line"><span class="comment">其他接口一起使用</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UsersDao</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Users</span>,</span></span><br><span class="line"><span class="class"><span class="title">Integer</span>&gt;,<span class="title">JpaSpecificationExecutor</span>&lt;<span class="title">Users</span>&gt;</span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="测试方法-5"><a href="#测试方法-5" class="headerlink" title="测试方法"></a>测试方法</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* JpaRepository 接口测试</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(<span class="string">"classpath:applicationContext.xml"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RepositoryTest</span> </span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UsersDao usersDao;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 需求：根据用户姓名查询数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">Specification&lt;Users&gt; spec = <span class="keyword">new</span> Specification&lt;Users&gt;() &#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> Predicate:定义了查询条件</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> Root&lt;Users&gt; root:根对象。封装了查询条件的对象</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> CriteriaQuery&lt;?&gt; query:定义了一个基本的查询.一般不</span></span><br><span class="line"><span class="comment">使用</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> CriteriaBuilder cb:创建一个查询条件</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;Users&gt; root,</span></span></span><br><span class="line"><span class="function"><span class="params">CriteriaQuery&lt;?&gt; query, CriteriaBuilder cb)</span> </span>&#123;</span><br><span class="line">Predicate pre = cb.equal(root.get(<span class="string">"username"</span>), <span class="string">"王五"</span>);</span><br><span class="line"><span class="keyword">return</span> pre;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">List&lt;Users&gt; list = <span class="keyword">this</span>.usersDao.findAll(spec);</span><br><span class="line"><span class="keyword">for</span> (Users users : list) &#123;</span><br><span class="line">System.out.println(users);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="多条件查询"><a href="#多条件查询" class="headerlink" title="多条件查询"></a>多条件查询</h5><h6 id="给定查询条件方式一"><a href="#给定查询条件方式一" class="headerlink" title="给定查询条件方式一"></a>给定查询条件方式一</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 多条件查询 方式一</span></span><br><span class="line"><span class="comment">* 需求：使用用户姓名以及年龄查询数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span></span>&#123;</span><br><span class="line">Specification&lt;Users&gt; spec = <span class="keyword">new</span> Specification&lt;Users&gt;() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;Users&gt; root,</span></span></span><br><span class="line"><span class="function"><span class="params">CriteriaQuery&lt;?&gt; query, CriteriaBuilder cb)</span> </span>&#123;</span><br><span class="line">List&lt;Predicate&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">list.add(cb.equal(root.get(<span class="string">"username"</span>),<span class="string">"王五"</span>));</span><br><span class="line">list.add(cb.equal(root.get(<span class="string">"userage"</span>),<span class="number">24</span>));</span><br><span class="line"><span class="comment">//此时条件之间是没有任何关系的。</span></span><br><span class="line">Predicate[] arr = <span class="keyword">new</span> Predicate[list.size()];</span><br><span class="line"><span class="keyword">return</span> cb.and(list.toArray(arr));</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">List&lt;Users&gt; list = <span class="keyword">this</span>.usersDao.findAll(spec);</span><br><span class="line"><span class="keyword">for</span> (Users users : list) &#123;</span><br><span class="line">System.out.println(users);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="给定查询条件方式二"><a href="#给定查询条件方式二" class="headerlink" title="给定查询条件方式二"></a>给定查询条件方式二</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 多条件查询 方式二</span></span><br><span class="line"><span class="comment">* 需求：使用用户姓名或者年龄查询数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span></span>&#123;</span><br><span class="line">Specification&lt;Users&gt; spec = <span class="keyword">new</span> Specification&lt;Users&gt;() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;Users&gt; root,</span></span></span><br><span class="line"><span class="function"><span class="params">CriteriaQuery&lt;?&gt; query, CriteriaBuilder cb)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> cb.or(cb.equal(root.get(<span class="string">"username"</span>),<span class="string">"王五</span></span><br><span class="line"><span class="string">"</span>),cb.equal(root.get(<span class="string">"userage"</span>), <span class="number">25</span>));</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">List&lt;Users&gt; list = <span class="keyword">this</span>.usersDao.findAll(spec);</span><br><span class="line"><span class="keyword">for</span> (Users users : list) &#123;</span><br><span class="line">System.out.println(users);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 需求：查询王姓用户，并且做分页处理</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//条件</span></span><br><span class="line">Specification&lt;Users&gt; spec = <span class="keyword">new</span> Specification&lt;Users&gt;() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;Users&gt; root,</span></span></span><br><span class="line"><span class="function"><span class="params">CriteriaQuery&lt;?&gt; query, CriteriaBuilder cb)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> cb.like(root.get(<span class="string">"username"</span>).as(String.class),</span><br><span class="line"><span class="string">"王%"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//分页</span></span><br><span class="line">Pageable pageable = <span class="keyword">new</span> PageRequest(<span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">Page&lt;Users&gt; page = <span class="keyword">this</span>.usersDao.findAll(spec, pageable);</span><br><span class="line">System.out.println(<span class="string">"总条数："</span>+page.getTotalElements());</span><br><span class="line">System.out.println(<span class="string">"总页数："</span>+page.getTotalPages());</span><br><span class="line">List&lt;Users&gt; list = page.getContent();</span><br><span class="line"><span class="keyword">for</span> (Users users : list) &#123;</span><br><span class="line">System.out.println(users);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 需求：查询数据库中王姓的用户，并且根据用户 id 做倒序排序</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test5</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//条件</span></span><br><span class="line">Specification&lt;Users&gt; spec = <span class="keyword">new</span> Specification&lt;Users&gt;() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;Users&gt; root,</span></span></span><br><span class="line"><span class="function"><span class="params">CriteriaQuery&lt;?&gt; query, CriteriaBuilder cb)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> cb.like(root.get(<span class="string">"username"</span>).as(String.class),</span><br><span class="line"><span class="string">"王%"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//排序</span></span><br><span class="line">Sort sort = <span class="keyword">new</span> Sort(Direction.DESC,<span class="string">"userid"</span>);</span><br><span class="line">List&lt;Users&gt; list = <span class="keyword">this</span>.usersDao.findAll(spec, sort);</span><br><span class="line"><span class="keyword">for</span> (Users users : list) &#123;</span><br><span class="line">System.out.println(users);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="分页与排序"><a href="#分页与排序" class="headerlink" title="分页与排序"></a>分页与排序</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 需求：查询数据库中王姓的用户，做分页处理，并且根据用户 id 做倒序排序</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test6</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//排序等定义</span></span><br><span class="line">Sort sort = <span class="keyword">new</span> Sort(Direction.DESC,<span class="string">"userid"</span>);</span><br><span class="line"><span class="comment">//分页的定义</span></span><br><span class="line">Pageable pageable = <span class="keyword">new</span> PageRequest(<span class="number">2</span>,<span class="number">2</span>, sort);</span><br><span class="line"><span class="comment">//查询条件</span></span><br><span class="line">Specification&lt;Users&gt; spec = <span class="keyword">new</span> Specification&lt;Users&gt;() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;Users&gt; root,</span></span></span><br><span class="line"><span class="function"><span class="params">CriteriaQuery&lt;?&gt; query, CriteriaBuilder cb)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> cb.like(root.get(<span class="string">"username"</span>).as(String.class),</span><br><span class="line"><span class="string">"王%"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">Page&lt;Users&gt; page = <span class="keyword">this</span>.usersDao.findAll(spec, pageable);</span><br><span class="line">System.out.println(<span class="string">"总条数："</span>+page.getTotalElements());</span><br><span class="line">System.out.println(<span class="string">"总页数："</span>+page.getTotalPages());</span><br><span class="line">List&lt;Users&gt; list = page.getContent();</span><br><span class="line"><span class="keyword">for</span> (Users users : list) &#123;</span><br><span class="line">System.out.println(users);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="用户自定义-Repository-接口"><a href="#用户自定义-Repository-接口" class="headerlink" title="用户自定义 Repository 接口"></a>用户自定义 Repository 接口</h5><blockquote>
<p>还是按照方法名查找</p>
</blockquote>
<h6 id="创建接口-6"><a href="#创建接口-6" class="headerlink" title="创建接口"></a>创建接口</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UsersRepository</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Users <span class="title">findUserById</span><span class="params">(Integer userid)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="使用接口"><a href="#使用接口" class="headerlink" title="使用接口"></a>使用接口</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 用户自定义 Repository 接口讲解</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UsersDao</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Users</span>,</span></span><br><span class="line"><span class="class"><span class="title">Integer</span>&gt;,<span class="title">JpaSpecificationExecutor</span>&lt;<span class="title">Users</span>&gt;,<span class="title">UsersRepository</span></span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="创建接口实现类"><a href="#创建接口实现类" class="headerlink" title="创建接口实现类"></a>创建接口实现类</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UsersDaoImpl</span> <span class="keyword">implements</span> <span class="title">UsersRepository</span> </span>&#123;</span><br><span class="line"><span class="meta">@PersistenceContext</span>(name=<span class="string">"entityManagerFactory"</span>)</span><br><span class="line"><span class="keyword">private</span> EntityManager em;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Users <span class="title">findUserById</span><span class="params">(Integer userid)</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"MyRepository......"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>.em.find(Users.class, userid);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="编写测试代码"><a href="#编写测试代码" class="headerlink" title="编写测试代码"></a>编写测试代码</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* JpaRepository 接口测试</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(<span class="string">"classpath:applicationContext.xml"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RepositoryTest</span> </span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UsersDao usersDao;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 需求：根据用户 ID 查询数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">Users users = <span class="keyword">this</span>.usersDao.findUserById(<span class="number">5</span>);</span><br><span class="line">System.out.println(users);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://fankekeke.club/2019/01/03/SpringData-JPA/" data-id="cjrabl6rq0044vkdqqkj1nth4" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java工具与中间件/">Java工具与中间件</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Oracle/">Oracle</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/SSH/">SSH</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/SSM/">SSM</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/SpringBoot/">SpringBoot</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/SpringData/">SpringData</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/消息队列/">消息队列</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/面试题/">面试题</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/API/">API</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分享/">分享</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/导航/">导航</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/工具/">工具</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/API/" style="font-size: 10px;">API</a> <a href="/tags/分享/" style="font-size: 20px;">分享</a> <a href="/tags/导航/" style="font-size: 10px;">导航</a> <a href="/tags/工具/" style="font-size: 10px;">工具</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/01/21/Rabbit交换器/">Rabbit交换器</a>
          </li>
        
          <li>
            <a href="/2019/01/16/监控SpringBoot健康状况/">监控SpringBoot健康状况</a>
          </li>
        
          <li>
            <a href="/2019/01/14/Java获取当前计算机信息/">Java获取当前计算机信息</a>
          </li>
        
          <li>
            <a href="/2019/01/14/三网短信验证码API/">三网短信验证码API</a>
          </li>
        
          <li>
            <a href="/2019/01/11/Quartz/">Quartz</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 樊可<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>